# üçÑ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –ó–ê–í–ï–†–®–ï–ù–ê - –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê

–ú–∏–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–ø—Ç–æ–≤ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É.

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ù–´–ï –≠–¢–ê–ü–´:

### –≠–¢–ê–ü 1: –°–û–ó–î–ê–ù–ò–ï PROMPT SERVICE ‚úÖ
- [x] –°–æ–∑–¥–∞–Ω `PromptService` –≤ `server/services/promptService.js`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (5 –º–∏–Ω—É—Ç)
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ fallback —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î
- [x] –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `Prompt` –≤ `server/models/prompt.js`

### –≠–¢–ê–ü 2: –ü–ï–†–ï–ü–ò–°–ö–ê CLAUDE SERVICE ‚úÖ
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `PromptService` –≤ `ClaudeService`
- [x] –ó–∞–º–µ–Ω–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ:
  - `_getSystemPrompt(language)` ‚Üí async —á–µ—Ä–µ–∑ PromptService
  - `_getRagPrompt(language)` ‚Üí async —á–µ—Ä–µ–∑ PromptService
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å async –ø—Ä–æ–º–ø—Ç–∞–º–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ —Ç–∏–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

### –≠–¢–ê–ü 3: –û–ß–ò–°–¢–ö–ê –§–ê–ô–õ–û–í–´–• –ü–†–û–ú–ü–¢–û–í ‚úÖ
- [x] –û—á–∏—â–µ–Ω `server/config/prompts.js` –æ—Ç —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- [x] –°–æ–∑–¥–∞–Ω `server/config/fallbackPrompts.js` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã deprecation warnings –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –≠–¢–ê–ü 4: –ü–û–î–ì–û–¢–û–í–ö–ê –ü–†–û–ú–ü–¢–û–í –î–õ–Ø –ê–î–ú–ò–ù–ö–ò ‚úÖ
- [x] –°–æ–∑–¥–∞–Ω `scripts/defaultPrompts.json` —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- [x] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/loadDefaultPrompts.js` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –≠–¢–ê–ü 5: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –°–ï–†–í–ï–†–û–ú ‚úÖ
- [x] –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `promptService` –≤ `server/index.js`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PromptService –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `startServer()`
- [x] –í–∫–ª—é—á–µ–Ω —Å—Ç–∞—Ç—É—Å PromptService –≤ health check endpoint
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback —Å–∏—Å—Ç–µ–º–æ–π
- [x] API —Ä–æ—É—Ç `/api/prompts` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò:

```
üçÑ –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê:
üì± –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí üóÑÔ∏è MongoDB ‚Üí ‚ö° PromptService (–∫–µ—à) ‚Üí ü§ñ Claude
                              ‚Üì
                         üõ°Ô∏è Fallback –ø—Ä–æ–º–ø—Ç—ã (–µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)

üóëÔ∏è –°–¢–ê–†–ê–Ø –°–ò–°–¢–ï–ú–ê (—É–¥–∞–ª–µ–Ω–∞):
üìÑ –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Üí ü§ñ Claude
```

## üìã –¢–ò–ü–´ –ü–†–û–ú–ü–¢–û–í:

1. **basic** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (EN, ES, RU)
2. **rag** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (EN, ES, RU)  
3. **ticket_detection** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤
4. **categorization** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤
5. **subject** - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∏–∫–µ—Ç–æ–≤

## üîÑ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ï–†–í–ï–†–ê:

–ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `startServer()`:
1. üì° MongoDB connection
2. üçÑ **PromptService initialization** ‚Üê **–î–û–ë–ê–í–õ–ï–ù–û**
3. üß† Vector Store initialization (–µ—Å–ª–∏ RAG –≤–∫–ª—é—á–µ–Ω)
4. üöÄ HTTP Server start

## üìä HEALTH CHECK:

Endpoint `/api/health` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
```json
{
  "services": {
    "database": "ok",
    "vectorStore": "ok", 
    "ai": "ok",
    "prompts": "ok"  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
  },
  "promptService": {
    "status": "healthy",
    "cacheStats": {...},
    "databaseConnection": true
  }
}
```

## üíª –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:

### ‚úÖ –ù–û–í–´–ô –ö–û–î (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):
```javascript
const promptService = require('../services/promptService');
const prompt = await promptService.getActivePrompt('basic', 'en');
```

### ‚ùå –°–¢–ê–†–´–ô –ö–û–î (deprecated):
```javascript
const { getSystemPrompt } = require('../config/prompts');
const prompt = getSystemPrompt('basic', 'en'); // –≤—ã–¥–∞—Å—Ç warning
```

## üìÅ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´:

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `server/services/promptService.js` - **–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å**
- ‚úÖ `server/services/claude.js` - **–æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è PromptService**
- ‚úÖ `server/config/prompts.js` - **–æ—á–∏—â–µ–Ω, —Ç–æ–ª—å–∫–æ fallback**
- ‚úÖ `server/config/fallbackPrompts.js` - **–Ω–æ–≤—ã–π —Ñ–∞–π–ª**
- ‚úÖ `server/index.js` - **–¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PromptService**

### API –∏ –º–æ–¥–µ–ª–∏:
- ‚úÖ `server/api/prompts.js` - **—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**
- ‚úÖ `server/models/prompt.js` - **–º–æ–¥–µ–ª—å –¥–ª—è MongoDB**

### –°–∫—Ä–∏–ø—Ç—ã:
- ‚úÖ `scripts/defaultPrompts.json` - **—É–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã**
- ‚úÖ `scripts/loadDefaultPrompts.js` - **—Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏**

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –ü–†–û–î–ê–ö–®–ù–ê:

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –≤ –ë–î:
```bash
node scripts/loadDefaultPrompts.js
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm start

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check
curl http://localhost:3000/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
curl http://localhost:3000/api/prompts
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ PromptService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:

1. **Fallback —Å–∏—Å—Ç–µ–º–∞**: –ï—Å–ª–∏ MongoDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ `fallbackPrompts.js`

2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–º–ø—Ç—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **Graceful degradation**: –û—à–∏–±–∫–∏ PromptService –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–µ—Ä–∞

4. **Backward compatibility**: –°—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –≤—ã–≤–æ–¥—è—Ç warnings

## üéâ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´:

‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –ø—Ä–æ–º–ø—Ç—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –±–µ–∑ –¥–µ–ø–ª–æ—è  
‚úÖ **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** - —É–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö  
‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å  
‚úÖ **Fallback —Å–∏—Å—Ç–µ–º–∞** - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î  
‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤  
‚úÖ **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã  
‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ  
‚úÖ **Health monitoring** - –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–ø—Ç–æ–≤  

---

## üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

üéâ **–ú–ò–ì–†–ê–¶–ò–Ø –ü–†–û–ú–ü–¢–û–í –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê!**

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ. –í—Å–µ —ç—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, —Å–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω, fallback —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞. –ü—Ä–æ–º–ø—Ç—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –¥–µ–ø–ª–æ—é!** üçÑ
