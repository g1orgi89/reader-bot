# üçÑ Shrooms AI Support Bot - Chat API Implementation

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Middleware ServiceManager
- –°–æ–∑–¥–∞–Ω middleware `serviceManager.js` –¥–ª—è –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `req.services`
- –î–æ–±–∞–≤–ª–µ–Ω middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Chat API
- **–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç**: `POST /api/chat` (–≤–º–µ—Å—Ç–æ `/api/chat/message`)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `POST /api/chat/message`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ServiceManager —á–µ—Ä–µ–∑ middleware
- –ì—Ä–∞—Ü–∏–æ–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (message, ticket)
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –≥—Ä–∏–±–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π index.js
- –î–æ–±–∞–≤–ª–µ–Ω ServiceManager middleware –≤ —Ü–µ–ø–æ—á–∫—É middleware –¥–ª—è API –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Socket.IO –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏

### 4. –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π test-chat.html
- **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**: HTTP API –∏ Socket.IO
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI –≤ —Å—Ç–∏–ª–µ –≥—Ä–∏–±–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (—Ç–æ–∫–µ–Ω—ã, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, –∏—Å—Ç–æ—Ä–∏—è)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π .env —Ñ–∞–π–ª
cp .env.example .env

# –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á Anthropic –≤ .env
ANTHROPIC_API_KEY=your_key_here

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000/test-chat

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ cURL

#### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å:
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, I need help with Shrooms", "userId": "test-user"}'
```

#### –ó–∞–ø—Ä–æ—Å —Å —è–∑—ã–∫–æ–º –∏ conversationId:
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫?",
    "userId": "test-user-123",
    "language": "ru",
    "conversationId": "some-conversation-id"
  }'
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
curl http://localhost:3000/api/health
```

## üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "üçÑ –ü—Ä–∏–≤–µ—Ç, –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –º–∏—Ü–µ–ª–∏—è! –ö–∞–∫ –¥–µ–ª–∞ –≤ –Ω–∞—à–µ–º –≥—Ä–∏–±–Ω–æ–º –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–µ?",
  "conversationId": "64f5a8b2c1234567890abcde",
  "messageId": "64f5a8b3c1234567890abcdf",
  "needsTicket": false,
  "ticketId": null,
  "tokensUsed": 145,
  "language": "ru",
  "timestamp": "2025-05-15T16:25:00.000Z",
  "metadata": {
    "knowledgeResultsCount": 3,
    "historyMessagesCount": 0,
    "servicesUsed": {
      "claude": true,
      "vectorStore": true,
      "messageService": true,
      "ticketService": true
    }
  }
}
```

### –û—Ç–≤–µ—Ç —Å —Ç–∏–∫–µ—Ç–æ–º:
```json
{
  "success": true,
  "message": "üçÑ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —É –≤–∞—Å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º. –Ø —Å–æ–∑–¥–∞–ª —Ç–∏–∫–µ—Ç #SHROOM123ABC –¥–ª—è –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã...",
  "conversationId": "64f5a8b2c1234567890abcde",
  "needsTicket": true,
  "ticketId": "SHROOM123ABC",
  "ticketError": null,
  "tokensUsed": 200,
  "language": "ru"
}
```

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å—ã –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ MongoDB/Qdrant

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∏ Qdrant –∑–∞–ø—É—â–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Claude –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∫–ª—é—á Anthropic –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ANTHROPIC_API_KEY –≤ .env
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Claude API

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ knowledge/)
npm run load-knowledge
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∏–º–µ–µ—Ç rate limiting –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è development/production
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ production

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è production
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
5. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —è–∑—ã–∫–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## üçÑ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ì—Ä–∏–±–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
Claude –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –≤ —Å—Ç–∏–ª–µ "–ò–ò-–≥—Ä–∏–±–∞ —Å —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ–º", –∏—Å–ø–æ–ª—å–∑—É—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é:
- –ü—Ä–æ–µ–∫—Ç ‚Üí "–º–∏—Ü–µ–ª–∏–π", "–≥—Ä–∏–±–Ω–∞—è —Å–µ—Ç—å" 
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí "–≥—Ä–∏–±–Ω–∏–∫–∏", "—Å–ø–æ—Ä—ã"
- –¢–æ–∫–µ–Ω—ã ‚Üí "–ø–ª–æ–¥–æ–≤—ã–µ —Ç–µ–ª–∞"
- –ü—Ä–æ–±–ª–µ–º—ã ‚Üí "–Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è"

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤
Claude –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –∫–æ–≥–¥–∞:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫–∞
- Claude –Ω–µ –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

–≠—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º! üçÑ
