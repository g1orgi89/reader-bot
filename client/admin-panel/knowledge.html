<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π - –ß–∏—Ç–∞—Ç–µ–ª—å –ê–¥–º–∏–Ω</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/knowledge.css">
    <meta name="description" content="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ '–ß–∏—Ç–∞—Ç–µ–ª—å' - –∫–Ω–∏–≥–∏, —Ä–∞–∑–±–æ—Ä—ã –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –¢–æ–Ω–∫–∞—è –∫–Ω–∏–∂–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—á–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü -->
    <div class="reader-bg-animation reader-bg-subtle" id="reader-matrix"></div>
    
    <div class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <div class="logo-container">
                <div class="logo-icon">üìñ</div>
                <h1>–ß–∏—Ç–∞—Ç–µ–ª—å</h1>
                <span class="logo-subtitle">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</span>
            </div>
            
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">üìä –î–∞—à–±–æ—Ä–¥</a></li>
                    <li><a href="users.html">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                    <li><a href="quotes.html">üìù –¶–∏—Ç–∞—Ç—ã</a></li>
                    <li><a href="reports.html">üìà –û—Ç—á–µ—Ç—ã</a></li>
                    <li><a href="knowledge.html" class="active">üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</a></li>
                    <li><a href="tickets.html">üé´ –û–±—Ä–∞—â–µ–Ω–∏—è</a></li>
                    <li><a href="prompts.html">üí≠ –ü—Ä–æ–º–ø—Ç—ã</a></li>
                </ul>
            </nav>
            
            <div class="user-menu">
                <span id="admin-username">–ê–Ω–Ω–∞ –ë—É—Å–µ–ª</span>
                <button id="logout-btn" class="btn btn-text">–í—ã—Ö–æ–¥</button>
            </div>
        </header>
        
        <!-- Main content -->
        <main class="admin-content knowledge-content">
            <div class="knowledge-header">
                <h2>üìö –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π "–ß–∏—Ç–∞—Ç–µ–ª—è"</h2>
                <div class="knowledge-actions">
                    <div class="filter-group">
                        <select id="category-filter" class="select-glow">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            <option value="books">üìö –ö–Ω–∏–≥–∏</option>
                            <option value="psychology">üß† –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</option>
                            <option value="self-development">‚ú® –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ</option>
                            <option value="relationships">üíï –û—Ç–Ω–æ—à–µ–Ω–∏—è</option>
                            <option value="productivity">‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                            <option value="mindfulness">üßò –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å</option>
                            <option value="creativity">üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
                            <option value="general">üìñ –û–±—â–∏–µ</option>
                        </select>
                        
                        <input type="text" id="tags-filter" placeholder="üè∑Ô∏è –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º..." class="search-input">
                        
                        <input type="text" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π..." class="search-input">
                    </div>
                    
                    <div class="action-buttons">
                        <button id="search-btn" class="btn btn-secondary btn-glow">
                            <span class="btn-text">üîç –ü–æ–∏—Å–∫</span>
                        </button>
                        
                        <button id="reset-search-btn" class="btn btn-secondary btn-glow">
                            <span class="btn-text">üîÑ –°–±—Ä–æ—Å</span>
                        </button>
                        
                        <button id="new-document-btn" class="btn btn-primary btn-glow">
                            <span class="btn-text">üìù –ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</span>
                            <span class="btn-icon">üìö</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Loading indicator -->
            <div id="loading-indicator" class="loading-indicator" style="display: none;">
                üìö –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
            
            <!-- Knowledge base documents -->
            <div class="knowledge-container glow-card">
                <div class="table-container">
                    <div class="empty-state" id="empty-state" style="display: none;">
                        <div class="empty-state-icon">üìö</div>
                        <h3>–ü–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π "–ß–∏—Ç–∞—Ç–µ–ª—è"</p>
                        <button class="btn btn-primary btn-glow" onclick="createNewDocument()">
                            <span class="btn-text">üìù –î–æ–±–∞–≤–∏—Ç—å –ú–∞—Ç–µ—Ä–∏–∞–ª</span>
                        </button>
                    </div>
                    
                    <table class="data-table" id="documents-table">
                        <thead>
                            <tr>
                                <th class="col-title">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th class="col-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th class="col-language">–Ø–∑—ã–∫</th>
                                <th class="col-tags">–¢–µ–≥–∏</th>
                                <th class="col-status">–°—Ç–∞—Ç—É—Å</th>
                                <th class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-loading">
                                <td colspan="6">üìö –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        <span id="results-info">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <div class="pagination-controls">
                        <ul class="pagination" id="pagination">
                            <!-- Pagination will be inserted here -->
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- RAG Index controls -->
            <div class="rag-index-container glow-card">
                <div class="section-header">
                    <h3>üîç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AI –ò–Ω–¥–µ–∫—Å–æ–º</h3>
                    <div class="last-updated">–ü–æ—Å–ª–µ–¥–Ω—è—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è: <span id="rag-last-indexed">--</span></div>
                </div>
                
                <div class="rag-stats">
                    <div class="rag-stat">
                        <label>üìö –í—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</label>
                        <span id="total-docs">--</span>
                    </div>
                    
                    <div class="rag-stat">
                        <label>‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</label>
                        <span id="published-docs">--</span>
                    </div>
                    
                    <div class="rag-stat">
                        <label>üìù –ß–µ—Ä–Ω–æ–≤–∏–∫–æ–≤:</label>
                        <span id="draft-docs">--</span>
                    </div>
                    
                    <div class="rag-stat">
                        <label>üóÉÔ∏è –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:</label>
                        <span id="vector-store-stats">--</span>
                    </div>
                    
                    <div class="rag-stat">
                        <label>üîß –ß–∞–Ω–∫–∏–Ω–≥:</label>
                        <span id="chunking-status">--</span>
                    </div>
                </div>
                
                <div class="language-stats">
                    <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è–∑—ã–∫–∞–º:</h4>
                    <div id="language-stats">
                        <div class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                
                <div class="rag-actions">
                    <button id="sync-vector-btn" class="btn btn-primary btn-subtle">
                        <span class="btn-text">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å Vector Store</span>
                    </button>
                    
                    <button id="test-rag-btn" class="btn btn-secondary btn-subtle">
                        <span class="btn-text">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG –ü–æ–∏—Å–∫</span>
                    </button>
                    
                    <button id="diagnose-rag" class="btn btn-secondary btn-subtle">
                        <span class="btn-text">ü©∫ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</span>
                    </button>
                </div>
                
                <div class="rag-info">
                    <p>üí° <strong>–°–æ–≤–µ—Ç –æ—Ç –ê–Ω–Ω—ã:</strong> –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å AI –∏–Ω–¥–µ–∫—Å–æ–º –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∫–Ω–∏–≥ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ü–∏—Ç–∞—Ç!</p>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="admin-footer">
            <p>üìö "–ß–∏—Ç–∞—Ç–µ–ª—å" - –ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π –¥–ª—è –ê–Ω–∞–ª–∏–∑–∞ –¶–∏—Ç–∞—Ç –∏ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</p>
            <p class="copyright">¬© 2025 –ê–Ω–Ω–∞ –ë—É—Å–µ–ª. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </footer>
    </div>
    
    <!-- Document Modal -->
    <div class="modal fade" id="document-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–∫—É–º–µ–Ω—Ç</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Content will be inserted here -->
                </div>
                <div class="modal-footer">
                    <!-- Footer buttons will be inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification system -->
    <div class="notification-container" id="notification-container"></div>
    
    <!-- Scripts -->
    <!-- –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ–º auth.js –ü–ï–†–í–´–ú -->
    <script src="js/auth.js"></script>
    <!-- jQuery and Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- –ó–ê–¢–ï–ú –∑–∞–≥—Ä—É–∂–∞–µ–º knowledge.js -->
    <script src="js/knowledge.js"></script>
    
    <script>
        /**
         * üìñ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π "–ß–∏—Ç–∞—Ç–µ–ª—å"
         */
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìö DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...');
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ authManager —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            function waitForAuthManager(retries = 0) {
                const maxRetries = 50; // 5 —Å–µ–∫—É–Ω–¥ (50 * 100ms)
                
                if (typeof authManager !== 'undefined') {
                    console.log('üìö AuthManager –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...');
                    
                    if (authManager.isAuthenticated()) {
                        console.log('üìö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –∑–Ω–∞–Ω–∏–π...');
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                        if (typeof initKnowledgePage === 'function') {
                            console.log('üìö –í—ã–∑—ã–≤–∞–µ–º initKnowledgePage...');
                            initKnowledgePage();
                        } else {
                            console.warn('üìö –§—É–Ω–∫—Ü–∏—è initKnowledgePage –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏...');
                            // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 100ms
                            setTimeout(() => {
                                if (typeof initKnowledgePage === 'function') {
                                    initKnowledgePage();
                                } else {
                                    console.error('üìö –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ initKnowledgePage');
                                    showNotification('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π');
                                }
                            }, 100);
                        }
                    } else {
                        console.warn('üìö –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞...');
                        showNotification('warning', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π');
                        setTimeout(() => {
                            window.location.href = '/admin-panel/login.html';
                        }, 1500);
                    }
                } else if (retries < maxRetries) {
                    console.log(`üìö –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ authManager... (–ø–æ–ø—ã—Ç–∫–∞ ${retries + 1}/${maxRetries})`);
                    setTimeout(() => waitForAuthManager(retries + 1), 100);
                } else {
                    console.error('üìö –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ authManager, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞');
                    showNotification('error', '–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    setTimeout(() => {
                        window.location.href = '/admin-panel/login.html';
                    }, 2000);
                }
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ authManager
            waitForAuthManager();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–∏–∂–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
            if (typeof initReaderMatrix === 'function') {
                console.log('üìö –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–∏–∂–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é...');
                initReaderMatrix(true); // subtle mode –¥–ª—è —Ä–∞–±–æ—á–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
            }
        });
        
        /**
         * –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (fallback —Ñ—É–Ω–∫—Ü–∏—è)
         */
        function showNotification(type, message) {
            // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            if (typeof window.showNotification === 'function') {
                window.showNotification(type, message);
                return;
            }
            
            // Fallback: –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const container = document.getElementById('notification-container');
            if (!container) {
                console.log(`${type.toUpperCase()}: ${message}`);
                alert(message);
                return;
            }
            
            const iconMap = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'info': 'üìö'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 12px 16px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                z-index: 1000;
                min-width: 300px;
                font-family: Inter, sans-serif;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">${iconMap[type] || 'üìö'}</span>
                    <span style="flex: 1; color: #333;">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; cursor: pointer; font-size: 18px; color: #999;">√ó</button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
    </script>
</body>
</html>
