<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ß–∏—Ç–∞—Ç–µ–ª—å</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/login.css">
    <meta name="description" content="–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ '–ß–∏—Ç–∞—Ç–µ–ª—å' - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="login-page">
    <!-- –ö–Ω–∏–∂–Ω–∞—è —Ñ–æ–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è -->
    <div class="reader-bg-animation" id="reader-matrix"></div>
    
    <div class="login-container">
        <div class="login-card">
            <!-- –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="login-header">
                <div class="logo-container">
                    <div class="logo-icon">üìñ</div>
                    <h1>–ß–∏—Ç–∞—Ç–µ–ª—å</h1>
                </div>
                <p class="login-subtitle">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π</p>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        required 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                        autocomplete="username"
                        class="form-input"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        autocomplete="current-password"
                        class="form-input"
                    >
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="remember" name="remember" class="checkbox">
                        <span class="checkbox-text">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</span>
                    </label>
                </div>
                
                <button type="submit" class="login-button" id="login-button">
                    <span class="button-text">–í–æ–π—Ç–∏</span>
                    <span class="button-icon">üîê</span>
                </button>
            </form>
            
            <!-- –î–µ–º–æ-—É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="demo-credentials">
                <p class="demo-title">üìù –î–µ–º–æ-–¥–æ—Å—Ç—É–ø:</p>
                <div class="demo-info">
                    <div class="demo-item">
                        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> anna
                    </div>
                    <div class="demo-item">
                        <strong>–ü–∞—Ä–æ–ª—å:</strong> reader2025
                    </div>
                </div>
            </div>
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="login-footer">
                <p class="footer-text">¬© 2025 –ê–Ω–Ω–∞ –ë—É—Å–µ–ª. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <p class="footer-description">–ü—Ä–æ–µ–∫—Ç "–ß–∏—Ç–∞—Ç–µ–ª—å" - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ —Ü–∏—Ç–∞—Ç —Å AI-–∞–Ω–∞–ª–∏–∑–æ–º</p>
            </div>
        </div>
    </div>
    
    <!-- Notification system -->
    <div class="notification-container" id="notification-container"></div>
    
    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ
            if (typeof authManager !== 'undefined' && authManager.isAuthenticated()) {
                console.log('üìñ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
                window.location.href = 'index.html';
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
            initLoginForm();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–Ω–∏–∂–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
            if (typeof initReaderMatrix === 'function') {
                initReaderMatrix();
            }
        });
        
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
         */
        function initLoginForm() {
            const form = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginButton = document.getElementById('login-button');
            
            if (!form || !usernameInput || !passwordInput || !loginButton) {
                console.error('üîê –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞');
                return;
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();
                
                if (!username || !password) {
                    displayNotification('error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                setLoginLoading(true);
                
                try {
                    // –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    const result = await authManager.login(username, password);
                    
                    if (result.success) {
                        displayNotification('success', `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.user.displayName}!`);
                        
                        // –ü–∞—É–∑–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1000);
                    } else {
                        displayNotification('error', result.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    }
                } catch (error) {
                    console.error('üîê –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                    displayNotification('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞');
                } finally {
                    setLoginLoading(false);
                }
            });
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
            const demoItems = document.querySelectorAll('.demo-item');
            demoItems.forEach(item => {
                item.addEventListener('click', () => {
                    const text = item.textContent;
                    if (text.includes('anna')) {
                        usernameInput.value = 'anna';
                        usernameInput.focus();
                    } else if (text.includes('reader2025')) {
                        passwordInput.value = 'reader2025';
                        passwordInput.focus();
                    }
                });
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
            usernameInput.focus();
        }
        
        /**
         * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑–∫–∏
         */
        function setLoginLoading(loading) {
            const button = document.getElementById('login-button');
            if (!button) {
                console.error('üîê Login button not found');
                return;
            }
            
            const buttonText = button.querySelector('.button-text');
            const buttonIcon = button.querySelector('.button-icon');
            
            if (!buttonText || !buttonIcon) {
                console.error('üîê Button text or icon not found', { 
                    button: button,
                    innerHTML: button.innerHTML,
                    buttonText: buttonText, 
                    buttonIcon: buttonIcon 
                });
                // Fallback - –∏–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–ø—Ä—è–º—É—é
                if (loading) {
                    button.disabled = true;
                    button.textContent = '–í—Ö–æ–¥...';
                } else {
                    button.disabled = false;
                    button.innerHTML = '<span class="button-text">–í–æ–π—Ç–∏</span><span class="button-icon">üîê</span>';
                }
                return;
            }
            
            if (loading) {
                button.disabled = true;
                button.classList.add('loading');
                buttonText.textContent = '–í—Ö–æ–¥...';
                buttonIcon.innerHTML = '<div class="spinner"></div>';
            } else {
                button.disabled = false;
                button.classList.remove('loading');
                buttonText.textContent = '–í–æ–π—Ç–∏';
                buttonIcon.textContent = 'üîê';
            }
        }
        
        /**
         * –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞)
         */
        function displayNotification(type, message) {
            console.log(`üîê Notification: ${type} - ${message}`);
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é showNotification –∏–∑ main.js
            if (typeof window.showNotification === 'function') {
                try {
                    window.showNotification(type, message);
                    return;
                } catch (error) {
                    console.error('üîê Error with global showNotification:', error);
                }
            }
            
            // –ü—Ä–æ—Å—Ç–æ–π fallback - —Å–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            createSimpleNotification(type, message);
        }
        
        /**
         * –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ fallback
         */
        function createSimpleNotification(type, message) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const existingNotifications = document.querySelectorAll('.simple-notification');
            existingNotifications.forEach(n => n.remove());
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = `simple-notification simple-notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : '#e74c3c'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 300px;
                animation: slideInRight 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const form = document.getElementById('login-form');
                if (form && document.activeElement && document.activeElement.form === form) {
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
                    e.preventDefault();
                    const event = new Event('submit', { cancelable: true });
                    form.dispatchEvent(event);
                }
            }
        });
    </script>
</body>
</html>