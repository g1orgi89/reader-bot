# üìä Reader Analytics System - –ü–æ–ª–Ω–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "–ß–∏—Ç–∞—Ç–µ–ª—å" v4.0.0**

## üéØ –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è Telegram-–±–æ—Ç–∞ "–ß–∏—Ç–∞—Ç–µ–ª—å" –ê–Ω–Ω—ã –ë—É—Å–µ–ª, –≤–∫–ª—é—á–∞—é—â–∞—è:
- **Real-time –¥–∞—à–±–æ—Ä–¥** —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- **MongoDB –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å fallback —Ä–µ–∂–∏–º–æ–º
- **UTM tracking** –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤  
- **Retention analysis** –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º
- **–¢–æ–ø –∫–æ–Ω—Ç–µ–Ω—Ç** –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## üöÄ –ß—Ç–æ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ Backend (API)
- **`server/api/analytics.js`** - –ü–æ–ª–Ω—ã–π Analytics API v3.0.0
- **`server/services/analyticsService.js`** - –°–µ—Ä–≤–∏—Å —Å MongoDB –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **`server/types/reader-analytics.js`** - JSDoc —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏–∑ UserProfile, Quote, UTMClick, PromoCodeUsage
- **Fallback —Ä–µ–∂–∏–º** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ Frontend (Dashboard)  
- **`client/admin-panel/reader-analytics.html`** - –î–∞—à–±–æ—Ä–¥ UI v4.0.0
- **`client/admin-panel/js/reader-analytics-dashboard.js`** - JavaScript v4.0.0
- **–ö–Ω–∏–∂–Ω—ã–π –¥–∏–∑–∞–π–Ω** –≤ —Å—Ç–∏–ª–µ "–ß–∏—Ç–∞—Ç–µ–ª—è" (–∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ —Ç–æ–Ω–∞)
- **Chart.js –≥—Ä–∞—Ñ–∏–∫–∏** —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

## üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –î–∞—à–±–æ—Ä–¥–∞

### 1. –û–±–∑–æ—Ä–Ω–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```javascript
{
  totalUsers: 15,      // –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  newUsers: 4,         // –ù–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥  
  totalQuotes: 58,     // –í—Å–µ–≥–æ —Ü–∏—Ç–∞—Ç
  avgQuotesPerUser: 3.9, // –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  activeUsers: 11,     // –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  promoUsage: 3        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
}
```

### 2. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¢—Ä–∞—Ñ–∏–∫–∞ (–ì—Ä–∞—Ñ–∏–∫-–ø–æ–Ω—á–∏–∫)
- üì± Instagram
- ‚úàÔ∏è Telegram  
- üì∫ YouTube
- üßµ Threads
- üë• –î—Ä—É–∑—å—è
- üîó –î—Ä—É–≥–æ–µ

### 3. UTM –ö–∞–º–ø–∞–Ω–∏–∏ (–°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫)
- üìß reader_recommendations
- üìä weekly_report
- üì¢ monthly_announcement
- üìö book_promo

### 4. Retention Analysis (–õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)
```javascript
{
  cohort: "2025-01",
  size: 15,
  week1: 85,  // 85% retention
  week2: 70,  // 70% retention  
  week3: 58,  // 58% retention
  week4: 45   // 45% retention
}
```

### 5. –¢–æ–ø –ö–æ–Ω—Ç–µ–Ω—Ç
- üèÜ **–¢–æ–ø –∞–≤—Ç–æ—Ä—ã**: –≠—Ä–∏—Ö –§—Ä–æ–º–º, –ú–∞—Ä–∏–Ω–∞ –¶–≤–µ—Ç–∞–µ–≤–∞, –ê–Ω–Ω–∞ –ë—É—Å–µ–ª
- üè∑Ô∏è **–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**: –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ, –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è, –§–∏–ª–æ—Å–æ—Ñ–∏—è
- ‚≠ê **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã**: –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ

## üõ†Ô∏è API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```bash
GET /api/analytics/dashboard?period=7d
GET /api/analytics/retention  
GET /api/analytics/top-content?period=30d
```

### –¢—Ä–µ–∫–∏–Ω–≥
```bash
POST /api/analytics/track-utm
POST /api/analytics/track-promo  
POST /api/analytics/track-action
```

### –£—Ç–∏–ª–∏—Ç—ã
```bash
GET /api/analytics/test           # Health check
GET /api/analytics/export?format=json
GET /api/analytics/metadata
```

## üé® –î–∏–∑–∞–π–Ω –∏ UX

### –¶–≤–µ—Ç–æ–≤–∞—è –°—Ö–µ–º–∞ "–ß–∏—Ç–∞—Ç–µ–ª—è"
- **–û—Å–Ω–æ–≤–Ω–æ–π**: `#8b4513` (SaddleBrown)
- **–ê–∫—Ü–µ–Ω—Ç**: `#cd853f` (Peru)  
- **–°–≤–µ—Ç–ª—ã–π**: `#deb887` (BurlyWood)
- **–§–æ–Ω**: `#f5f1eb` (LinenBeige)

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- ‚å®Ô∏è **–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏**: Ctrl+R (–æ–±–Ω–æ–≤–∏—Ç—å), Ctrl+E (—ç–∫—Å–ø–æ—Ä—Ç)
- üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- üì± **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- üé≠ **–ê–Ω–∏–º–∞—Ü–∏–∏**: –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ hover —ç—Ñ—Ñ–µ–∫—Ç—ã

## üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ö–æ–ª–ª–µ–∫—Ü–∏–∏
```javascript
// MongoDB Collections
UserProfile     // –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
Quote          // –¶–∏—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
UTMClick       // –ö–ª–∏–∫–∏ –ø–æ UTM —Å—Å—ã–ª–∫–∞–º
PromoCodeUsage // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
WeeklyReport   // –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
MonthlyReport  // –ú–µ—Å—è—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
```

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö
```javascript
// –ü—Ä–∏–º–µ—Ä: –¢–æ–ø –∞–≤—Ç–æ—Ä—ã
await Quote.aggregate([
  { $match: { createdAt: { $gte: startDate }, author: { $ne: null } } },
  { $group: { _id: '$author', count: { $sum: 1 } } },
  { $sort: { count: -1 } },
  { $limit: 10 }
]);
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
npm list mongoose chart.js express
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB
```javascript
// server/models/ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
// - userProfile.js
// - quote.js  
// - analytics.js (UTMClick, PromoCodeUsage)
```

### 3. –ó–∞–ø—É—Å–∫ API
```bash
# API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞:
# GET /api/analytics/test - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
# GET /api/analytics/dashboard - –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### 4. –û—Ç–∫—Ä—ã—Ç–∏–µ –î–∞—à–±–æ—Ä–¥–∞
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
http://localhost:3000/admin-panel/reader-analytics.html
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
curl http://localhost:3000/api/analytics/test
# –û—Ç–≤–µ—Ç: {"success": true, "message": "Analytics API —Ä–∞–±–æ—Ç–∞–µ—Ç!", "version": "3.0.0"}
```

### –õ–æ–≥–∏
```javascript
// –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
üìä Reader Analytics Dashboard v4.0.0 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
üìä API —Ä–∞–±–æ—Ç–∞–µ—Ç: Analytics API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π! 3.0.0
üìä –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–∞ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

// –ö–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞:  
üìä Analytics: DASHBOARD endpoint: –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞
üìä Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞: 15 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 58 —Ü–∏—Ç–∞—Ç
```

## üîÑ Fallback –†–µ–∂–∏–º

–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è fallback:

```javascript
// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
{
  overview: {
    totalUsers: 15,
    newUsers: 4, 
    totalQuotes: 58,
    avgQuotesPerUser: 3.9,
    activeUsers: 11,
    promoUsage: 3
  },
  fallbackMode: true  // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞
}
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥** ‚Üí `reader-analytics.html`
2. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥** ‚Üí 1d/7d/30d/90d
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** ‚Üí –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ** ‚Üí –∫–Ω–æ–ø–∫–∞ "üì• –≠–∫—Å–ø–æ—Ä—Ç" –∏–ª–∏ Ctrl+E

### –î–ª—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
const response = await fetch('/api/analytics/dashboard?period=7d');
const data = await response.json();
console.log(data.data.overview.totalUsers);

// –û—Ç–ø—Ä–∞–≤–∫–∞ UTM —Ç—Ä–µ–∫–∞
await fetch('/api/analytics/track-utm', {
  method: 'POST',
  body: JSON.stringify({
    utm_source: 'telegram',
    utm_campaign: 'weekly_report', 
    user_id: '12345'
  })
});
```

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ü—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: Fallback –¥–∞–Ω–Ω—ã–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: MongoDB aggregation –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö  
- **UX**: –ö–Ω–∏–∂–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏ –ø–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: JSDoc —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **API Health**: `/api/analytics/test`
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- **–ú–µ—Ç—Ä–∏–∫–∏**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã online/offline —Ä–µ–∂–∏–º–∞

---

**üéâ –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ "–ß–∏—Ç–∞—Ç–µ–ª—å" –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞!**

*–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –ê–Ω–Ω—ã –ë—É—Å–µ–ª*