# üîç WORK LOG APP25 - VIEWPORT DIAGNOSTICS SYSTEM

**–î–∞—Ç–∞:** 02.08.2025  
**–¢–∏–ø:** Mini App Development  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED  
**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ viewport –ø—Ä–æ–±–ª–µ–º –¥–ª—è Telegram Mini App

## üéØ –ó–ê–î–ê–ß–ê

–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã —Å viewport –≤ Mini App:
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ —Å–Ω–∏–∑—É –Ω–∞–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- **–ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ:** –í –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ iPhone, —Ä–∞–∑–Ω–∞—è –≤—ã—Å–æ—Ç–∞, –Ω–∞–µ–∑–∂–∞–µ—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ  
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –°–µ—Ä–≤–µ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

### 1. **server/models/ViewportLog.js** - –ú–æ–¥–µ–ª—å –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```javascript
// MongoDB –º–æ–¥–µ–ª—å –¥–ª—è —Å–±–æ—Ä–∞ viewport –¥–∞–Ω–Ω—ã—Ö
- –°—Ö–µ–º–∞ —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–æ–ª—è–º–∏
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–±–ª–µ–º
```

### 2. **server/api/debug.js** - API –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```javascript
// Express router —Å endpoints:
POST /api/debug/viewport       // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
GET  /api/debug/viewport/stats // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º  
GET  /api/debug/viewport/analysis // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
DELETE /api/debug/viewport/clear   // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
```

### 3. **mini-app/js/utils/viewport-tracker.js** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ç—Ä–µ–∫–µ—Ä
```javascript
// –ö–ª–∞—Å—Å ViewportTracker:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ viewport
- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ resize/orientation events
- Telegram Web App SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Debug —Ä–µ–∂–∏–º —Å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
```

### 4. **server/index.js** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω debug route:
app.use(`${config.app.apiPrefix}/debug`, debugRoutes);
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API –≤ startup
```

### 5. **mini-app/index.html** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫–µ—Ä–∞
```html
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ viewport-tracker.js -->
<!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->  
<!-- Debug –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ window.debugViewport -->
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã:**
```
üì± Mini App (–∫–ª–∏–µ–Ω—Ç)
    ‚Üì viewport –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
üåê Express API (/api/debug/viewport)
    ‚Üì —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
üóÑÔ∏è MongoDB (viewport_logs collection)
    ‚Üì –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```

### **–î–∞–Ω–Ω—ã–µ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è:**
```javascript
{
  viewport: {
    innerHeight: 844,           // window.innerHeight
    telegramHeight: 780,        // Telegram.WebApp.viewportHeight  
    calculatedContentHeight: 620, // CSS calc() —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    actualContentHeight: 560,   // –†–µ–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ .content
    difference: -60,            // –ü–†–û–ë–õ–ï–ú–ù–ê–Ø –ó–û–ù–ê!
    bottomNavHeight: 64,
    headerHeight: 56
  },
  device: {
    platform: "iOS",
    userAgent: "iPhone...",
    orientation: "portrait"
  },
  problem: {
    type: "empty_space_bottom",
    severity: "moderate", 
    description: "60px gap between content and navigation"
  }
}
```

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø—Ä–æ–±–ª–µ–º—ã (empty_space_bottom, content_overflow, height_mismatch)
- –†–∞—Å—á–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ (minor < 10px, moderate < 50px, severe > 50px)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## üöÄ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º:**
```javascript
// –¢—Ä–µ–∫–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Mini App
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã > 5px
```

### **Debug –∫–æ–º–∞–Ω–¥—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
```javascript
// –í DevTools Console:
window.debugViewport.start()    // –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–∫–µ—Ä–∞
window.debugViewport.stop()     // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
window.debugViewport.measure()  // –†–∞–∑–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ
window.debugViewport.send()     // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
```

### **API –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–±–ª–µ–º
GET /api/debug/viewport/stats?platform=iOS&days=7

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
GET /api/debug/viewport/analysis?problemType=empty_space_bottom

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
DELETE /api/debug/viewport/clear?days=30
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è –∏–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
1. **–¢–æ—á–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã** - —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å iPhone
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º** - iOS vs Android vs Desktop  
3. **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** - –∫–æ–≥–¥–∞ –∏ –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è
4. **–î–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è CSS fixes

### **–û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–π–¥–µ–º:**
```javascript
// –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
{
  commonProblems: [
    { type: "empty_space_bottom", count: 85%, avgDifference: "-45px" },
    { type: "content_overflow", count: 15%, avgDifference: "+20px" }
  ],
  platforms: [
    { platform: "iOS", issues: 70% },      // –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
    { platform: "Android", issues: 20% },
    { platform: "Desktop", issues: 10% }
  ],
  pages: [
    { page: "home", problemRate: 80% },    // –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º
    { page: "diary", problemRate: 60% }
  ]
}
```

## üîç –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### **–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**
1. **–ê–Ω–∞–ª–∏–∑ —Å–æ–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** - –ø–æ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CSS —Ñ–æ—Ä–º—É–ª** - –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π** - —Å –ø–æ–º–æ—â—å—é —Ç–æ–≥–æ –∂–µ —Ç—Ä–µ–∫–µ—Ä–∞
4. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** - –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

### **–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```css
/* –í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö calc() —Ñ–æ—Ä–º—É–ª: */
.content {
  /* –°—Ç–∞—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: */
  /* height: calc(100vh - var(--bottom-nav-height) - var(--header-height) - 40px); */
  
  /* –ù–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: */
  height: calc(var(--tg-viewport-height, 100vh) - 120px);
  min-height: calc(var(--tg-viewport-height, 100vh) - 120px);
}
```

## ‚ö° –°–¢–ê–¢–£–° –ó–ê–î–ê–ß–ò

- ‚úÖ **–ú–æ–¥–µ–ª—å ViewportLog** —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ **Debug API** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  
- ‚úÖ **Viewport Tracker** —Å–æ–∑–¥–∞–Ω
- ‚úÖ **Server routes** –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ **Mini App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫** –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ **Debug –∫–æ–º–∞–Ω–¥—ã** –¥–æ–±–∞–≤–ª–µ–Ω—ã

## üéØ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö!**

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö API routes
2. **–û—Ç–∫—Ä—ã—Ç—å Mini App –Ω–∞ iPhone** - –≤ Telegram
3. **–ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - —É–≤–∏–¥–µ—Ç—å viewport –¥–∞–Ω–Ω—ã–µ
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API** - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–°–ª–µ–¥—É—é—â–∏–π WORK_LOG:** –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ viewport –ø—Ä–æ–±–ª–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 45 –º–∏–Ω—É—Ç  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** High (Full-stack –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** Critical (–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ UX)