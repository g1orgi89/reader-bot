<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reader Bot</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- CSS —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- üì± –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">üìö</div>
            <div class="loading-text">Reader Bot</div>
            <div class="loading-subtitle">–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏...</div>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- üè† –ì–õ–ê–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div id="app" class="app-container" style="display: none;">
        
        <!-- üìã –®–ê–ü–ö–ê –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ - –¢–û–õ–¨–ö–û –ú–ï–ù–Æ -->
        <div id="home-header" class="home-header" style="display: none;">
            <div class="page-title">
                <h1>üìö Reader Bot</h1>
                <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏</p>
            </div>
            <button class="menu-btn" id="homeMenuBtn">‚ò∞</button>
        </div>

        <!-- üìã –û–ë–´–ß–ù–ê–Ø –®–ê–ü–ö–ê –î–õ–Ø –û–°–¢–ê–õ–¨–ù–´–• –°–¢–†–ê–ù–ò–¶ -->
        <div id="page-header" class="page-header" style="display: none;">
            <button class="back-btn" id="backBtn">‚Üê</button>
            <span class="page-title" id="pageTitle">–°—Ç—Ä–∞–Ω–∏—Ü–∞</span>
            <button class="menu-btn" id="pageMenuBtn">‚ò∞</button>
        </div>

        <!-- üìÑ –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –°–û–î–ï–†–ñ–ò–ú–û–ì–û –°–¢–†–ê–ù–ò–¶ -->
        <div id="page-content" class="page-content">
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        </div>

        <!-- üì± –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <nav id="bottom-nav" class="bottom-nav">
            <div class="nav-item active" data-page="home">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                </svg>
                <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
            </div>
            
            <div class="nav-item" data-page="diary">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                </svg>
                <span class="nav-label">–î–Ω–µ–≤–Ω–∏–∫</span>
            </div>
            
            <div class="nav-item" data-page="reports">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
                </svg>
                <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
            </div>
            
            <div class="nav-item" data-page="catalog">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                </svg>
                <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
            </div>
            
            <div class="nav-item" data-page="community">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="nav-label">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
            </div>
        </nav>

        <!-- üéØ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ú–ï–ù–Æ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ) -->
        <div id="menu-modal" class="menu-modal" style="display: none;">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—é –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- üìö JavaScript —Ñ–∞–π–ª—ã -->
    
    <!-- –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/core/State.js"></script>
    <script src="js/core/Router.js"></script>
    <script src="js/core/App.js"></script>
    
    <!-- –°–µ—Ä–≤–∏—Å—ã -->
    <script src="js/services/TelegramService.js"></script>
    <script src="js/services/ApiService.js"></script>
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="js/components/BottomNavigation.js"></script>
    <script src="js/components/TopMenu.js"></script>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <script src="js/pages/HomePage.js"></script>
    <script src="js/pages/DiaryPage.js"></script>
    <script src="js/pages/ReportsPage.js"></script>
    <script src="js/pages/CatalogPage.js"></script>
    <script src="js/pages/CommunityPage.js"></script>
    <script src="js/pages/OnboardingPage.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Telegram Web App
        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
            console.log('üöÄ Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Telegram Web App
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram
            const themeParams = window.Telegram.WebApp.themeParams;
            if (themeParams.bg_color) {
                document.documentElement.style.setProperty('--tg-bg-color', themeParams.bg_color);
            }
            if (themeParams.text_color) {
                document.documentElement.style.setProperty('--tg-text-color', themeParams.text_color);
            }
        } else {
            console.log('üß™ –ó–∞–ø—É—Å–∫ –≤ debug —Ä–µ–∂–∏–º–µ (–Ω–µ –≤ Telegram)');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('üîÑ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Reader Bot');
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const app = new ReaderApp();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                await app.init();
                
                console.log('‚úÖ Reader Bot —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.innerHTML = `
                        <div class="loading-content">
                            <div class="loading-logo">‚ö†Ô∏è</div>
                            <div class="loading-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div class="loading-subtitle">${error.message}</div>
                            <button onclick="location.reload()" class="retry-btn">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </div>
                    `;
                }
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–∞—á-—Å–æ–±—ã—Ç–∏–π –¥–ª—è –ª—É—á—à–µ–≥–æ UX
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>