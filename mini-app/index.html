<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reader Bot</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- üé® CSS —Å—Ç–∏–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û) -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/base.css">
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã CSS -->
    <link rel="stylesheet" href="css/components/navigation.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/modals.css">
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã CSS -->
    <link rel="stylesheet" href="css/pages/home.css">
    <link rel="stylesheet" href="css/pages/diary.css">
    <link rel="stylesheet" href="css/pages/reports.css">
    <link rel="stylesheet" href="css/pages/catalog.css">
    <link rel="stylesheet" href="css/pages/community.css">
    
    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è -->
    <link rel="stylesheet" href="css/mobile.css">
</head>
<body>
    <!-- üì± –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">üìö</div>
            <div class="loading-text">Reader Bot</div>
            <div class="loading-subtitle">–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏...</div>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- üè† –ì–õ–ê–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div id="app" class="app-container" style="display: none;">
        
        <!-- üìã –®–ê–ü–ö–ê –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ (–ò–°–ü–†–ê–í–õ–ï–ù–û –ü–û–î home.css) -->
        <div id="home-header" class="home-header" style="display: none;">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">üë§</div>
                <div class="user-details">
                    <h3 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                    <p id="userStatus">–í–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏</p>
                </div>
            </div>
            <button class="menu-button" id="homeMenuBtn">‚ò∞</button>
        </div>

        <!-- üìã –û–ë–´–ß–ù–ê–Ø –®–ê–ü–ö–ê –î–õ–Ø –û–°–¢–ê–õ–¨–ù–´–• –°–¢–†–ê–ù–ò–¶ -->
        <div id="page-header" class="page-header" style="display: none;">
            <button class="back-btn" id="backBtn">‚Üê</button>
            <span class="page-title" id="pageTitle">–°—Ç—Ä–∞–Ω–∏—Ü–∞</span>
            <button class="menu-btn" id="pageMenuBtn">‚ò∞</button>
        </div>

        <!-- üìÑ –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –°–û–î–ï–†–ñ–ò–ú–û–ì–û –°–¢–†–ê–ù–ò–¶ -->
        <div id="page-content" class="page-content">
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        </div>

        <!-- üì± –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <nav id="bottom-nav" class="bottom-nav">
            <div class="nav-item active" data-page="home">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                </svg>
                <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
            </div>
            
            <div class="nav-item" data-page="diary">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                </svg>
                <span class="nav-label">–î–Ω–µ–≤–Ω–∏–∫</span>
            </div>
            
            <div class="nav-item" data-page="reports">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/>
                </svg>
                <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
            </div>
            
            <div class="nav-item" data-page="catalog">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                </svg>
                <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
            </div>
            
            <div class="nav-item" data-page="community">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span class="nav-label">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
            </div>
        </nav>

        <!-- üéØ –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (–î–û–ë–ê–í–õ–ï–ù–û) -->
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="menu-modal" class="menu-modal" style="display: none;">
            <div class="menu-backdrop"></div>
            <div class="menu-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—é –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ TopMenu.js -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
        <div id="achievements-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
        <div id="help-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–º–æ—â–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" -->
        <div id="about-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
    </div>

    <!-- üìö JavaScript —Ñ–∞–π–ª—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ü–£–¢–ò!) -->
    
    <!-- üîç –ù–û–í–û–ï: Viewport –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–ó–ê–ì–†–£–ñ–ê–ï–¢–°–Ø –ü–ï–†–í–´–ú) -->
    <script src="js/utils/viewport-tracker.js"></script>
    <!-- üîß –ù–û–í–û–ï: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä viewport –≤—ã—Å–æ—Ç—ã -->
    <script src="js/utils/viewport-calculator.js"></script>
    
    <!-- –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/core/State.js"></script>
    <script src="js/core/Router.js"></script>
    <script src="js/core/App.js"></script>
    
    <!-- –°–µ—Ä–≤–∏—Å—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ò–ú–ï–ù–ê –§–ê–ô–õ–û–í) -->
    <script src="js/services/telegram.js"></script>
    <script src="js/services/api.js"></script>
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ü–£–¢–ò) -->
    <script src="js/components/navigation/BottomNav.js"></script>
    <script src="js/components/navigation/TopMenu.js"></script>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <script src="js/pages/HomePage.js"></script>
    <script src="js/pages/DiaryPage.js"></script>
    <script src="js/pages/ReportsPage.js"></script>
    <script src="js/pages/CatalogPage.js"></script>
    <script src="js/pages/CommunityPage.js"></script>
    <script src="js/pages/OnboardingPage.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Telegram Web App
        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
            console.log('üöÄ Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Telegram Web App
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram
            const themeParams = window.Telegram.WebApp.themeParams;
            if (themeParams.bg_color) {
                document.documentElement.style.setProperty('--tg-bg-color', themeParams.bg_color);
            }
            if (themeParams.text_color) {
                document.documentElement.style.setProperty('--tg-text-color', themeParams.text_color);
            }
        } else {
            console.log('üß™ –ó–∞–ø—É—Å–∫ –≤ debug —Ä–µ–∂–∏–º–µ (–Ω–µ –≤ Telegram)');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('üîÑ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Reader Bot');
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const app = new ReaderApp();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                await app.init();
                
                console.log('‚úÖ Reader Bot —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // üîç –ù–û–í–û–ï: –ó–∞–ø—É—Å–∫–∞–µ–º viewport tracker –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                if (window.ViewportTracker && !window.viewportTracker) {
                    console.log('üîç –ó–∞–ø—É—Å–∫ Viewport Tracker...');
                    setTimeout(() => {
                        window.viewportTracker = new ViewportTracker();
                        window.viewportTracker.start();
                        console.log('‚úÖ Viewport Tracker –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏');
                    }, 3000); // –î–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
                }
                
                // üîß –ù–û–í–û–ï: Viewport Calculator –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–≤–æ–π –º–æ–¥—É–ª—å
                // –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.innerHTML = `
                        <div class="loading-content">
                            <div class="loading-logo">‚ö†Ô∏è</div>
                            <div class="loading-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div class="loading-subtitle">${error.message}</div>
                            <button onclick="location.reload()" class="retry-btn">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </div>
                    `;
                }
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–∞—á-—Å–æ–±—ã—Ç–∏–π –¥–ª—è –ª—É—á—à–µ–≥–æ UX
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // üîç DEBUG: –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è viewport tracker
        window.debugViewport = {
            start: () => {
                if (window.viewportTracker) {
                    window.viewportTracker.start();
                    console.log('üîç Viewport Tracker –∑–∞–ø—É—â–µ–Ω –≤—Ä—É—á–Ω—É—é');
                }
            },
            stop: () => {
                if (window.viewportTracker) {
                    window.viewportTracker.stop();
                    console.log('‚èπÔ∏è Viewport Tracker –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                }
            },
            measure: () => {
                if (window.viewportTracker) {
                    const measurement = window.viewportTracker.measureViewport();
                    console.log('üìè –¢–µ–∫—É—â–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è viewport:', measurement);
                    return measurement;
                }
            },
            send: () => {
                if (window.viewportTracker) {
                    window.viewportTracker.measureAndReport();
                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö viewport –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
                }
            },
            // üîß –ù–û–í–û–ï: Debug –∫–æ–º–∞–Ω–¥—ã –¥–ª—è viewport calculator
            calculator: {
                update: () => {
                    if (window.viewportCalculator) {
                        window.viewportCalculator.updateViewportHeight();
                        console.log('üîß Viewport Calculator –æ–±–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é');
                    }
                },
                start: () => {
                    if (window.viewportCalculator) {
                        window.viewportCalculator.start();
                        console.log('üîß Viewport Calculator –∑–∞–ø—É—â–µ–Ω –≤—Ä—É—á–Ω—É—é');
                    }
                },
                stop: () => {
                    if (window.viewportCalculator) {
                        window.viewportCalculator.stop();
                        console.log('üîß Viewport Calculator –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    }
                }
            }
        };
        
        console.log('üîç Debug –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ window.debugViewport');
    </script>
</body>
</html>