<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Reader Bot</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- üî§ Preload critical variable fonts for performance -->
    <link rel="preload" href="assets/fonts/Inter-VariableFont_opsz,wght.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="assets/fonts/Merriweather-VariableFont_opsz,wdth,wght.woff2" as="font" type="font/woff2" crossorigin>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π —à—Ä–∏—Ñ—Ç Neucha (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Neucha&display=swap" rel="stylesheet">
    
    <!-- üé® CSS —Å—Ç–∏–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û) -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/base.css">
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã CSS -->
    <link rel="stylesheet" href="css/components/navigation.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/modals.css">
    <link rel="stylesheet" href="css/components/quote-card.css">
    <link rel="stylesheet" href="css/components/skeleton.css">
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã CSS -->
    <link rel="stylesheet" href="css/pages/home.css">
    <link rel="stylesheet" href="css/pages/onboarding.css">
    <link rel="stylesheet" href="css/pages/diary.css">
    <link rel="stylesheet" href="css/pages/reports.css">
    <link rel="stylesheet" href="css/pages/catalog.css">
    <link rel="stylesheet" href="css/pages/community.css">
    <link rel="stylesheet" href="css/pages/navigation.css">
    
    <!-- Menu Pages CSS -->
    <link rel="stylesheet" href="css/pages/profile.css">
    <link rel="stylesheet" href="css/pages/achievements.css">
    <link rel="stylesheet" href="css/pages/settings.css">
    <link rel="stylesheet" href="css/pages/help.css">
    <link rel="stylesheet" href="css/pages/about.css">
    
    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è -->
    <link rel="stylesheet" href="css/mobile.css">
    
    <!-- üîß –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: iOS Navigation Fix (–ó–ê–ì–†–£–ñ–ê–ï–¢–°–Ø –ü–û–°–õ–ï–î–ù–ò–ú!) -->
    <link rel="stylesheet" href="css/ios-navigation-fix.css">
    
    <!-- üîß SCROLL FIX: Single scroll container override (loaded AFTER ios-navigation-fix.css) -->
    <link rel="stylesheet" href="css/scroll-fix.css">

    <!-- üîí BRAND LOCK (–Ω–µ –¥–∞—ë–º –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –±—Ä–µ–Ω–¥–æ–≤—ã–µ —Ü–≤–µ—Ç–∞) -->
    <style id="brand-lock-style">
        :root {
            --primary-color: #D2452C !important;
            --primary-light: #E5674F !important;
            --primary-dark: #B73A24 !important;
        }
    </style>

    <!-- üõ°Ô∏è BRAND MONITOR (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ª–∞–¥–∫–∏) -->
    <script>
    (function brandGuard(){
        if (window.__brandGuardInstalled) return;
        window.__brandGuardInstalled = true;

        const origSet = CSSStyleDeclaration.prototype.setProperty;
        CSSStyleDeclaration.prototype.setProperty = function(name, value, priority) {
            if (name === '--primary-color') {
                console.warn('[TRACE] –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å --primary-color ->', value, 'priority=', priority);
                console.trace();
            }
            return origSet.call(this, name, value, priority);
        };

        function ensureBrand() {
            const current = getComputedStyle(document.documentElement)
                .getPropertyValue('--primary-color').trim().toLowerCase();
            if (current && current !== '#d2452c') {
                document.documentElement.style.setProperty('--primary-color', '#D2452C');
                console.warn('[LOCK] –í–µ—Ä–Ω—É–ª–∏ --primary-color –∏–∑', current, '–≤ #D2452C');
            }
        }

        const mo = new MutationObserver(muts => {
            for (const m of muts) {
                if (m.attributeName === 'style') ensureBrand();
            }
        });
        mo.observe(document.documentElement, { attributes: true, attributeFilter: ['style'] });

        let t = 0;
        const int = setInterval(()=>{
            ensureBrand();
            if (++t > 30) clearInterval(int); // ~3 —Å–µ–∫
        }, 100);
    })();
    </script>
</head>
<body>
    <!-- üì± –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">üìö</div>
            <div class="loading-text">Reader Bot</div>
            <div class="loading-subtitle">–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à –¥–Ω–µ–≤–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏...</div>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- üè† –ì–õ–ê–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div id="app" class="app-container" style="display: none;">
        
        <!-- üìÑ –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –°–û–î–ï–†–ñ–ò–ú–û–ì–û –°–¢–†–ê–ù–ò–¶ (–ë–ï–ó –•–ï–î–ï–†–û–í!) -->
        <div id="page-content" class="page-content">
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            
            <!-- –ë–ª–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ü–∏—Ç–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω–æ–π (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
            <section id="home-latest-quotes" class="home-latest-quotes" style="display: none;"></section>
        </div>

        <!-- üì± –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <nav id="bottom-nav" class="bottom-nav" data-initialized="static">
          <div class="nav-item" data-page="home" data-route="/home">
            <div class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
              </svg>
            </div>
            <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
          </div>

          <div class="nav-item" data-page="diary" data-route="/diary">
            <div class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
              </svg>
            </div>
            <span class="nav-label">–î–Ω–µ–≤–Ω–∏–∫</span>
          </div>

          <div class="nav-item" data-page="reports" data-route="/reports">
            <div class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
                <path d="M8 14h.01"/>
                <path d="M12 14h.01"/>
                <path d="M16 14h.01"/>
                <path d="M8 18h.01"/>
                <path d="M12 18h.01"/>
                <path d="M16 18h.01"/>
              </svg>
            </div>
            <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
          </div>

          <div class="nav-item" data-page="catalog" data-route="/catalog">
            <div class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H10v20H6.5A2.5 2.5 0 0 1 4 19.5z"/>
                <path d="M12 2h3.5A2.5 2.5 0 0 1 18 4.5v15a2.5 2.5 0 0 1-2.5 2.5H12V2z"/>
                <path d="M20 2h1.5a2.5 2.5 0 0 1 2.5 2.5v15a2.5 2.5 0 0 1-2.5 2.5H20V2z"/>
                <line x1="2" y1="22" x2="22" y2="22"/>
              </svg>
            </div>
            <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
          </div>
    
          <div class="nav-item" data-page="community" data-route="/community">
            <div class="nav-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <span class="nav-label">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
          </div>
        </nav>

        <!-- üéØ –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="menu-modal" class="menu-modal" style="display: none;">
            <div class="menu-backdrop"></div>
            <div class="menu-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—é –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ TopMenu.js -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
        <div id="achievements-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
        <div id="help-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–º–æ—â–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" -->
        <div id="about-modal" class="modal" style="display: none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏" –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ -->
            </div>
        </div>
    </div>

    <!-- üìö JavaScript —Ñ–∞–π–ª—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ü–£–¢–ò!) -->
    
    <!-- üîç –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï: Comprehensive Debug System (–ó–ê–ì–†–£–ñ–ê–ï–¢–°–Ø –ü–ï–†–í–´–ú!) -->
    <script src="js/utils/comprehensive-debug-system-fixed.js"></script>
    
    <!-- üîß –ù–û–í–û–ï: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä viewport –≤—ã—Å–æ—Ç—ã -->
    <script src="js/utils/viewport-calculator.js"></script>
    
    <!-- üñºÔ∏è –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ -->
    <script src="js/utils/imageUtils.js"></script>
    
    <!-- üìÖ –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ -->
    <script src="js/utils/dateUtils.js"></script>
    
    <!-- üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ -->
    <script src="js/utils/quote-utils.js"></script>
    
    <!-- üõ†Ô∏è –û–±—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
    <script src="js/utils/helpers.js"></script>
    
    <!-- üçé –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: iOS —Ñ–∏–∫—Å—ã –ü–ï–†–ï–î telegram.js -->
    <script src="js/services/ios-fix.js"></script>
    
    <!-- –°–µ—Ä–≤–∏—Å—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ò–ú–ï–ù–ê –§–ê–ô–õ–û–í) -->
    <script src="js/services/telegram.js"></script>
    <script src="js/services/storage.js"></script>
    <script src="js/services/api.js"></script>
    <script src="js/services/StatisticsService.js"></script>

    <!-- –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/core/State.js"></script>
    <script src="js/core/Router.js"></script>
    <script src="js/core/App.js"></script>
    
    <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´ –ü–£–¢–ò) -->
    <script src="js/components/navigation/BottomNav.js"></script>
    <script src="js/components/navigation/TopMenu.js"></script>
    
    <!-- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
    <script src="js/components/ui/Modal.js"></script>
    
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <script src="js/pages/HomePage.js"></script>
    <script src="js/pages/DiaryPage.js"></script>
    <script src="js/pages/ReportsPage.js"></script>
    <script src="js/pages/CatalogPage.js"></script>
    <script src="js/pages/CommunityPage.js"></script>
    <script src="js/pages/OnboardingPage.js"></script>
    
    <!-- New pages for navigation -->
    <script src="js/pages/ProfilePage.js"></script>
    <script src="js/pages/AchievementsPage.js"></script>
    <script src="js/pages/SettingsPage.js"></script>
    <script src="js/pages/AboutPage.js"></script>
    <script src="js/pages/HelpPage.js"></script>
    
    <!-- Views for quotes -->
    <script src="js/views/MyQuotesView.js"></script>
    <script src="js/views/HomeView.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–û–†–ò–ì–ò–ù–ê–õ–ù–´–ô –ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù) -->
    <script>
        // üîß –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ù–ï–ú–ï–î–õ–ï–ù–ù–ê–Ø iOS –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø
        console.log('üçé –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è iOS —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è...');
        
        // –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –æ–±—ä—è–≤–ª–µ–Ω–∏–µ isIOSDevice
        window.isIOSDevice = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                            (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        
        let debugSessionId = null;
        
        if (window.isIOSDevice) {
            console.log('üçé iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ - –ø—Ä–∏–º–µ–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–∫—Å—ã...');
            document.documentElement.classList.add('ios-device');
            document.documentElement.style.cssText += `
                height: calc(100vh + 1px) !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                overscroll-behavior: none !important;
                -webkit-overscroll-behavior: none !important;
            `;
            document.body.style.cssText += `
                min-height: calc(100vh + 1px) !important;
                overscroll-behavior: none !important;
                -webkit-overscroll-behavior: none !important;
                -webkit-overflow-scrolling: touch !important;
            `;
            console.log('‚úÖ –ë–∞–∑–æ–≤—ã–µ iOS —Ñ–∏–∫—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ');
            if (window.ComprehensiveDebugSystemFixed) {
                console.log('üîç –ó–∞–ø—É—Å–∫ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô debug —Å–∏—Å—Ç–µ–º—ã –¥–ª—è iOS...');
                window.debugSystemFixed = new ComprehensiveDebugSystemFixed();
                const tempUserId = 'ios_debug_' + Date.now();
                window.debugSystemFixed.startSession(tempUserId).then(sessionId => {
                    debugSessionId = sessionId;
                    console.log('‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø Debug —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞:', sessionId);
                }).catch(error => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô debug —Å–∏—Å—Ç–µ–º—ã:', error);
                });
            }
        }
        
        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
            console.log('üöÄ Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            if (window.debugSystemFixed && window.isIOSDevice) {
                window.debugSystemFixed.log('TELEGRAM', 'INFO', 'Telegram WebApp detected', {
                    version: window.Telegram.WebApp.version,
                    platform: window.Telegram.WebApp.platform,
                    isExpanded: window.Telegram.WebApp.isExpanded
                });
            }
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            if (window.debugSystemFixed && window.isIOSDevice && debugSessionId) {
                const telegramUser = window.Telegram.WebApp.initDataUnsafe?.user;
                if (telegramUser) {
                    window.debugSystemFixed.endSession().then(() => {
                        return window.debugSystemFixed.startSession(telegramUser.id.toString());
                    }).then(newSessionId => {
                        debugSessionId = newSessionId;
                        console.log('‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø Debug —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞ —Å Telegram userId:', newSessionId);
                    }).catch(error => {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô debug —Å–∏—Å—Ç–µ–º—ã:', error);
                    });
                }
            }
            if (window.isIOSDevice) {
                console.log('üçé –ü—Ä–∏–º–µ–Ω—è–µ–º Telegram iOS —Ñ–∏–∫—Å—ã...');
                if (window.debugSystemFixed) {
                    window.debugSystemFixed.log('TELEGRAM', 'INFO', 'Applying Telegram iOS fixes');
                }
                if (window.Telegram.WebApp.disableVerticalSwipes) {
                    window.Telegram.WebApp.disableVerticalSwipes();
                    console.log('üîß iOS Fix: –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã');
                    if (window.debugSystemFixed) {
                        window.debugSystemFixed.log('TELEGRAM', 'INFO', 'Vertical swipes disabled for iOS');
                    }
                }
                if (window.Telegram.WebApp.safeAreaInset) {
                    const safeArea = window.Telegram.WebApp.safeAreaInset;
                    document.documentElement.style.setProperty('--tg-safe-area-top', `${safeArea.top}px`);
                    document.documentElement.style.setProperty('--tg-safe-area-bottom', `${safeArea.bottom}px`);
                    document.documentElement.style.setProperty('--tg-safe-area-left', `${safeArea.left}px`);
                    document.documentElement.style.setProperty('--tg-safe-area-right', `${safeArea.right}px`);
                    console.log('üîß iOS Fix: Safe Area —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', safeArea);
                    if (window.debugSystemFixed) {
                        window.debugSystemFixed.log('TELEGRAM', 'INFO', 'Safe Area configured', { safeArea });
                    }
                }
                const updateViewportHeight = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                    if (window.debugSystemFixed) {
                        window.debugSystemFixed.log('VIEWPORT', 'DEBUG', 'Viewport height updated', {
                            innerHeight: window.innerHeight,
                            vh: vh
                        });
                    }
                };
                updateViewportHeight();
                window.addEventListener('resize', updateViewportHeight);
                window.addEventListener('orientationchange', () => {
                    setTimeout(updateViewportHeight, 300);
                });
                console.log('‚úÖ Telegram iOS —Ñ–∏–∫—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
            }
            const themeParams = window.Telegram.WebApp.themeParams;
            if (themeParams.bg_color) {
                document.documentElement.style.setProperty('--tg-bg-color', themeParams.bg_color);
            }
            if (themeParams.text_color) {
                document.documentElement.style.setProperty('--tg-text-color', themeParams.text_color);
            }
        } else {
            console.log('üß™ –ó–∞–ø—É—Å–∫ –≤ debug —Ä–µ–∂–∏–º–µ (–Ω–µ –≤ Telegram)');
            if (window.debugSystemFixed && window.isIOSDevice) {
                window.debugSystemFixed.log('INIT', 'WARNING', 'Running in debug mode (not in Telegram)');
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('üîÑ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Reader Bot');
                if (window.debugSystemFixed && window.isIOSDevice) {
                    window.debugSystemFixed.log('INIT', 'INFO', 'Starting Reader Bot initialization');
                }
                const app = new ReaderApp();
                await app.init();
                console.log('‚úÖ Reader Bot —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                if (window.debugSystemFixed && window.isIOSDevice) {
                    window.debugSystemFixed.log('INIT', 'INFO', 'Reader Bot initialization completed successfully');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                if (window.debugSystemFixed && window.isIOSDevice) {
                    window.debugSystemFixed.log('ERROR', 'CRITICAL', 'Reader Bot initialization failed', {
                        error: error.message,
                        stack: error.stack
                    });
                }
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.innerHTML = `
                        <div class="loading-content">
                            <div class="loading-logo">‚ö†Ô∏è</div>
                            <div class="loading-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                            <div class="loading-subtitle">${error.message}</div>
                            <button onclick="location.reload()" class="retry-btn">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </div>
                    `;
                }
            }
        });
        
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
                if (window.debugSystemFixed && window.isIOSDevice) {
                    window.debugSystemFixed.log('TOUCH', 'WARNING', 'Multi-touch prevented', {
                        touchCount: e.touches.length
                    });
                }
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
                if (window.debugSystemFixed && window.isIOSDevice) {
                    window.debugSystemFixed.log('TOUCH', 'INFO', 'Double tap zoom prevented', {
                        timeSinceLastTouch: now - lastTouchEnd
                    });
                }
            }
            lastTouchEnd = now;
        }, false);
        
        window.getDebugStats = () => {
            if (window.debugSystemFixed) {
                return window.debugSystemFixed.getLocalStats();
            }
            return null;
        };
        
        window.recheckDebugServer = () => {
            if (window.debugSystemFixed) {
                return window.debugSystemFixed.recheckServer();
            }
            return false;
        };
        
        console.log('üîç –ì–ª–æ–±–∞–ª—å–Ω—ã–µ debug —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã: getDebugStats(), recheckDebugServer()');
    </script>
</body>
</html>
