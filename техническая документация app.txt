# üìö –ü–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Reader Mini App

---

# üîå API-INTEGRATION.md

## –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API

```javascript
// config/api-endpoints.js - 1 KB
const API_CONFIG = {
  BASE_URL: '/api/reader',
  TIMEOUT: 10000,
  RETRY_ATTEMPTS: 3,
  
  // Endpoints
  ENDPOINTS: {
    // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    AUTH_TELEGRAM: '/auth/telegram',
    
    // –¶–∏—Ç–∞—Ç—ã
    QUOTES: '/quotes',
    QUOTES_SEARCH: '/quotes/search',
    QUOTES_STATS: '/quotes/stats',
    
    // –û—Ç—á–µ—Ç—ã
    REPORTS_WEEKLY: '/reports/weekly',  
    REPORTS_MONTHLY: '/reports/monthly',
    
    // –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥
    BOOK_CATALOG: '/book-catalog',
    
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    ANALYTICS_STATS: '/analytics/stats',
    ANALYTICS_COMMUNITY: '/analytics/community-stats',
    ANALYTICS_TOP_READERS: '/analytics/top-readers-week',
    
    // –ê–Ω–æ–Ω—Å—ã –∏ –ø—Ä–æ–º–æ
    ANNOUNCEMENTS: '/announcements',
    PROMO_CODES: '/promo-codes',
    
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    USERS_PROFILE: '/users/profile',
    
    // AI —á–∞—Ç —Å –ê–Ω–Ω–æ–π
    CHAT: '/chat'
  }
};
```

## API Service Class

```javascript
// services/api.js - 8 KB
class APIService {
  constructor() {
    this.baseURL = API_CONFIG.BASE_URL;
    this.timeout = API_CONFIG.TIMEOUT;
    this.retryAttempts = API_CONFIG.RETRY_ATTEMPTS;
  }

  /**
   * –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ —Å retry –ª–æ–≥–∏–∫–æ–π
   */
  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const config = {
      timeout: this.timeout,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      },
      ...options
    };

    for (let attempt = 1; attempt <= this.retryAttempts; attempt++) {
      try {
        const response = await fetch(url, config);
        
        if (!response.ok) {
          throw new APIError(response.status, await response.text());
        }
        
        return await response.json();
        
      } catch (error) {
        if (attempt === this.retryAttempts) {
          throw error;
        }
        
        // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
        await this.delay(Math.pow(2, attempt) * 1000);
      }
    }
  }

  /**
   * GET –∑–∞–ø—Ä–æ—Å
   */
  async get(endpoint, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    const url = queryString ? `${endpoint}?${queryString}` : endpoint;
    return this.request(url, { method: 'GET' });
  }

  /**
   * POST –∑–∞–ø—Ä–æ—Å
   */
  async post(endpoint, data = {}) {
    return this.request(endpoint, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  /**
   * PUT –∑–∞–ø—Ä–æ—Å
   */
  async put(endpoint, data = {}) {
    return this.request(endpoint, {
      method: 'PUT', 
      body: JSON.stringify(data)
    });
  }

  /**
   * DELETE –∑–∞–ø—Ä–æ—Å
   */
  async delete(endpoint) {
    return this.request(endpoint, { method: 'DELETE' });
  }

  /**
   * –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è retry –ª–æ–≥–∏–∫–∏
   */
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä API
const api = new APIService();
```

## –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ API –º–µ—Ç–æ–¥—ã

```javascript
// –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
class QuotesAPI {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ü–∏—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  static async getUserQuotes(filters = {}) {
    const params = {
      page: filters.page || 1,
      limit: filters.limit || 20,
      category: filters.category,
      author: filters.author,
      search: filters.search
    };
    
    return api.get(API_CONFIG.ENDPOINTS.QUOTES, params);
  }

  /**
   * –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–∏—Ç–∞—Ç—É
   */
  static async addQuote(text, author = '', source = 'mini_app') {
    return api.post(API_CONFIG.ENDPOINTS.QUOTES, {
      text,
      author,
      source
    });
  }

  /**
   * –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—É
   */
  static async updateQuote(quoteId, updates) {
    return api.put(`${API_CONFIG.ENDPOINTS.QUOTES}/${quoteId}`, updates);
  }

  /**
   * –£–¥–∞–ª–∏—Ç—å —Ü–∏—Ç–∞—Ç—É
   */
  static async deleteQuote(quoteId) {
    return api.delete(`${API_CONFIG.ENDPOINTS.QUOTES}/${quoteId}`);
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ü–∏—Ç–∞—Ç
   */
  static async getQuoteStats(period = '7d') {
    return api.get(API_CONFIG.ENDPOINTS.QUOTES_STATS, { period });
  }
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
class ReportsAPI {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
   */
  static async getWeeklyReport() {
    return api.get(API_CONFIG.ENDPOINTS.REPORTS_WEEKLY);
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç
   */
  static async getMonthlyReport(month, year) {
    return api.get(API_CONFIG.ENDPOINTS.REPORTS_MONTHLY, { month, year });
  }
}

// –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
class CommunityAPI {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
   */
  static async getCommunityStats() {
    return api.get(API_CONFIG.ENDPOINTS.ANALYTICS_COMMUNITY);
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø —á–∏—Ç–∞—Ç–µ–ª–µ–π –Ω–µ–¥–µ–ª–∏
   */
  static async getTopReadersWeek() {
    return api.get(API_CONFIG.ENDPOINTS.ANALYTICS_TOP_READERS);
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ü–∏—Ç–∞—Ç—É –¥–Ω—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
   */
  static async getQuoteOfTheDay() {
    return api.get('/analytics/quote-of-day');
  }
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

```javascript
class APIError extends Error {
  constructor(status, message, details = null) {
    super(message);
    this.name = 'APIError';
    this.status = status;
    this.details = details;
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   */
  getUserMessage() {
    switch (this.status) {
      case 400:
        return '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.';
      case 401:
        return '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.';
      case 403:
        return '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é.';
      case 404:
        return '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.';
      case 429:
        return '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
      case 500:
        return '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
      default:
        return '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
    }
  }
}
```

---

# üì± TELEGRAM-SDK-GUIDE.md

## –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Web App

```javascript
// services/telegram.js - 5 KB
class TelegramIntegration {
  constructor() {
    this.webapp = window.Telegram?.WebApp;
    this.isAvailable = !!this.webapp;
    this.user = null;
    this.theme = 'light';
    
    if (this.isAvailable) {
      this.init();
    }
  }

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
   */
  init() {
    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    this.webapp.ready();
    this.webapp.expand();
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    this.user = this.webapp.initDataUnsafe?.user;
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É
    this.setupTheme();
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
    this.setupMainButton();
    this.setupBackButton();
    
    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è
    this.setupEventListeners();
    
    console.log('ü§ñ Telegram Web App initialized');
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   */
  setupTheme() {
    this.theme = this.webapp.colorScheme || 'light';
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –∫ body
    document.body.classList.toggle('dark-theme', this.theme === 'dark');
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
    this.webapp.onEvent('themeChanged', () => {
      this.theme = this.webapp.colorScheme;
      document.body.classList.toggle('dark-theme', this.theme === 'dark');
    });
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
   */
  setupMainButton() {
    const mainButton = this.webapp.MainButton;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    mainButton.hide();
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    mainButton.onClick(() => {
      this.handleMainButtonClick();
    });
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
   */
  setupBackButton() {
    const backButton = this.webapp.BackButton;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    backButton.onClick(() => {
      this.handleBackButtonClick();
    });
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ event listeners
   */
  setupEventListeners() {
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    this.webapp.onEvent('mainButtonClicked', this.handleMainButtonClick.bind(this));
    this.webapp.onEvent('backButtonClicked', this.handleBackButtonClick.bind(this));
  }

  /**
   * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
   */
  setMainButton(text, handler, params = {}) {
    const mainButton = this.webapp.MainButton;
    
    mainButton.setText(text);
    mainButton.color = params.color || this.webapp.themeParams.button_color;
    mainButton.textColor = params.textColor || this.webapp.themeParams.button_text_color;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    this._mainButtonHandler = handler;
    
    if (params.show !== false) {
      mainButton.show();
    }
  }

  /**
   * –°–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
   */
  hideMainButton() {
    this.webapp.MainButton.hide();
    this._mainButtonHandler = null;
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
   */
  showBackButton() {
    this.webapp.BackButton.show();
  }

  /**
   * –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
   */
  hideBackButton() {
    this.webapp.BackButton.hide();
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
   */
  handleMainButtonClick() {
    if (this._mainButtonHandler) {
      this._mainButtonHandler();
    }
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
   */
  handleBackButtonClick() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞–∑–∞–¥
    if (window.App?.router) {
      window.App.router.goBack();
    }
  }

  /**
   * Haptic Feedback - —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è
   */
  hapticFeedback(type = 'impact', style = 'light') {
    if (!this.isAvailable) return;

    const haptic = this.webapp.HapticFeedback;
    
    switch (type) {
      case 'impact':
        // light, medium, heavy, rigid, soft
        haptic.impactOccurred(style);
        break;
        
      case 'notification':
        // error, success, warning
        haptic.notificationOccurred(style);
        break;
        
      case 'selection':
        haptic.selectionChanged();
        break;
    }
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   */
  showAlert(message, callback) {
    if (!this.isAvailable) {
      alert(message);
      if (callback) callback();
      return;
    }
    
    this.webapp.showAlert(message, callback);
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   */
  showConfirm(message, callback) {
    if (!this.isAvailable) {
      const result = confirm(message);
      if (callback) callback(result);
      return;
    }
    
    this.webapp.showConfirm(message, callback);
  }

  /**
   * –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É
   */
  openLink(url, options = {}) {
    if (!this.isAvailable) {
      window.open(url, '_blank');
      return;
    }
    
    this.webapp.openLink(url, options);
  }

  /**
   * –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   */
  close() {
    if (this.isAvailable) {
      this.webapp.close();
    }
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   */
  getInitData() {
    return this.webapp?.initData || '';
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–º—ã
   */
  getThemeParams() {
    return this.webapp?.themeParams || {};
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
const telegram = new TelegramIntegration();
```

## –ö–∞—Ä—Ç–∞ Haptic Feedback

```javascript
// utils/haptic-map.js - 1 KB
const HAPTIC_MAP = {
  // –£—Å–ø–µ—à–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
  SUCCESS: { type: 'notification', style: 'success' },
  QUOTE_ADDED: { type: 'impact', style: 'light' },
  QUOTE_LIKED: { type: 'impact', style: 'light' },
  
  // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  PAGE_CHANGED: { type: 'impact', style: 'soft' },
  TAB_CHANGED: { type: 'selection' },
  MODAL_OPENED: { type: 'impact', style: 'light' },
  MODAL_CLOSED: { type: 'impact', style: 'soft' },
  
  // –û—à–∏–±–∫–∏
  ERROR: { type: 'notification', style: 'error' },
  VALIDATION_ERROR: { type: 'impact', style: 'medium' },
  NETWORK_ERROR: { type: 'impact', style: 'heavy' },
  
  // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  BUTTON_PRESS: { type: 'impact', style: 'light' },
  SWIPE: { type: 'impact', style: 'soft' },
  LONG_PRESS: { type: 'impact', style: 'medium' },
  
  // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
  ACHIEVEMENT_UNLOCKED: { type: 'impact', style: 'heavy' },
  REPORT_GENERATED: { type: 'impact', style: 'medium' },
  PURCHASE: { type: 'impact', style: 'rigid' }
};

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function haptic(action) {
  const config = HAPTIC_MAP[action];
  if (config && telegram.isAvailable) {
    telegram.hapticFeedback(config.type, config.style);
  }
}
```

---

# üíæ STATE-MANAGEMENT.md

## –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

```javascript
// core/State.js - 2 KB
class AppState {
  constructor() {
    this.state = {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
      user: null,
      isAuthenticated: false,
      
      // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      currentPage: 'home',
      pageHistory: ['home'],
      
      // –î–∞–Ω–Ω—ã–µ
      quotes: [],
      weeklyReport: null,
      communityStats: null,
      bookCatalog: [],
      
      // UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      isLoading: false,
      loadingMessage: '',
      error: null,
      modals: {},
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      theme: 'light',
      language: 'ru'
    };
    
    this.listeners = new Map();
    this.middleware = [];
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   */
  getState() {
    return { ...this.state };
  }

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   */
  setState(updates, actionType = 'UPDATE') {
    const prevState = { ...this.state };
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º middleware
    for (const mw of this.middleware) {
      updates = mw(prevState, updates, actionType) || updates;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    this.state = { ...this.state, ...updates };
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    this.notifyListeners(prevState, this.state, actionType);
    
    console.log(`üîÑ State updated [${actionType}]:`, updates);
  }

  /**
   * –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
   */
  subscribe(key, callback) {
    if (!this.listeners.has(key)) {
      this.listeners.set(key, []);
    }
    this.listeners.get(key).push(callback);
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø–∏—Å–∫–∏
    return () => {
      const callbacks = this.listeners.get(key);
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    };
  }

  /**
   * –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   */
  notifyListeners(prevState, newState, actionType) {
    this.listeners.forEach((callbacks, key) => {
      callbacks.forEach(callback => {
        callback(newState, prevState, actionType);
      });
    });
  }

  /**
   * –î–æ–±–∞–≤–∏—Ç—å middleware
   */
  addMiddleware(middleware) {
    this.middleware.push(middleware);
  }

  // === –î–ï–ô–°–¢–í–ò–Ø (ACTIONS) ===
  
  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  setUser(user) {
    this.setState({
      user,
      isAuthenticated: !!user
    }, 'SET_USER');
  }

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—ã
   */
  setQuotes(quotes) {
    this.setState({ quotes }, 'SET_QUOTES');
  }

  /**
   * –î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É
   */
  addQuote(quote) {
    const quotes = [...this.state.quotes];
    quotes.unshift(quote); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
    this.setState({ quotes }, 'ADD_QUOTE');
  }

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É
   */
  updateQuote(quoteId, updates) {
    const quotes = this.state.quotes.map(quote => 
      quote._id === quoteId ? { ...quote, ...updates } : quote
    );
    this.setState({ quotes }, 'UPDATE_QUOTE');
  }

  /**
   * –£–¥–∞–ª–∏—Ç—å —Ü–∏—Ç–∞—Ç—É
   */
  deleteQuote(quoteId) {
    const quotes = this.state.quotes.filter(quote => quote._id !== quoteId);
    this.setState({ quotes }, 'DELETE_QUOTE');
  }

  /**
   * –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
   */
  navigateTo(page) {
    const pageHistory = [...this.state.pageHistory];
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    if (pageHistory[pageHistory.length - 1] !== page) {
      pageHistory.push(page);
    }
    
    this.setState({
      currentPage: page,
      pageHistory
    }, 'NAVIGATE');
  }

  /**
   * –ù–∞–∑–∞–¥ –≤ –∏—Å—Ç–æ—Ä–∏–∏
   */
  goBack() {
    const pageHistory = [...this.state.pageHistory];
    
    if (pageHistory.length > 1) {
      pageHistory.pop(); // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      const prevPage = pageHistory[pageHistory.length - 1];
      
      this.setState({
        currentPage: prevPage,
        pageHistory
      }, 'GO_BACK');
      
      return prevPage;
    }
    
    return null;
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
   */
  showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
    this.setState({
      isLoading: true,
      loadingMessage: message,
      error: null
    }, 'SHOW_LOADING');
  }

  /**
   * –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
   */
  hideLoading() {
    this.setState({
      isLoading: false,
      loadingMessage: ''
    }, 'HIDE_LOADING');
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
   */
  showError(error) {
    this.setState({
      error: typeof error === 'string' ? error : error.message,
      isLoading: false
    }, 'SHOW_ERROR');
  }

  /**
   * –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É
   */
  hideError() {
    this.setState({ error: null }, 'HIDE_ERROR');
  }

  /**
   * –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
   */
  openModal(modalName, data = null) {
    const modals = { ...this.state.modals };
    modals[modalName] = { isOpen: true, data };
    this.setState({ modals }, 'OPEN_MODAL');
  }

  /**
   * –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
   */
  closeModal(modalName) {
    const modals = { ...this.state.modals };
    if (modals[modalName]) {
      modals[modalName].isOpen = false;
      modals[modalName].data = null;
    }
    this.setState({ modals }, 'CLOSE_MODAL');
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
const appState = new AppState();
```

## Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏

```javascript
// utils/state-middleware.js - 1 KB

/**
 * Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
 */
const loggingMiddleware = (prevState, updates, actionType) => {
  if (process.env.NODE_ENV === 'development') {
    console.group(`üîÑ State Action: ${actionType}`);
    console.log('Previous:', prevState);
    console.log('Updates:', updates);
    console.log('Next:', { ...prevState, ...updates });
    console.groupEnd();
  }
  return updates;
};

/**
 * Middleware –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
 */
const persistenceMiddleware = (prevState, updates, actionType) => {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  const persistKeys = ['user', 'theme', 'language'];
  const persistData = {};
  
  for (const key of persistKeys) {
    if (updates[key] !== undefined) {
      persistData[key] = updates[key];
    }
  }
  
  if (Object.keys(persistData).length > 0) {
    try {
      const existing = JSON.parse(localStorage.getItem('reader-app-state') || '{}');
      const merged = { ...existing, ...persistData };
      localStorage.setItem('reader-app-state', JSON.stringify(merged));
    } catch (error) {
      console.warn('Failed to persist state:', error);
    }
  }
  
  return updates;
};

/**
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
 */
function loadPersistedState() {
  try {
    const saved = localStorage.getItem('reader-app-state');
    return saved ? JSON.parse(saved) : {};
  } catch (error) {
    console.warn('Failed to load persisted state:', error);
    return {};
  }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º middleware
appState.addMiddleware(loggingMiddleware);
appState.addMiddleware(persistenceMiddleware);

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
const persistedState = loadPersistedState();
if (Object.keys(persistedState).length > 0) {
  appState.setState(persistedState, 'LOAD_PERSISTED');
}
```

---

# üêõ ERROR-HANDLING.md

## –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

```javascript
// utils/error-handler.js - 2 KB
class ErrorHandler {
  constructor() {
    this.errorQueue = [];
    this.isProcessing = false;
    this.setupGlobalHandlers();
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫
   */
  setupGlobalHandlers() {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Promise –æ—à–∏–±–æ–∫
    window.addEventListener('unhandledrejection', (event) => {
      console.error('Unhandled Promise rejection:', event.reason);
      this.handleError(event.reason, 'UNHANDLED_PROMISE');
      event.preventDefault();
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ JavaScript –æ—à–∏–±–æ–∫
    window.addEventListener('error', (event) => {
      console.error('JavaScript error:', event.error);
      this.handleError(event.error, 'JAVASCRIPT_ERROR');
    });
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É
   */
  async handleError(error, context = 'UNKNOWN') {
    const errorInfo = this.parseError(error, context);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
    this.errorQueue.push(errorInfo);
    
    // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
    this.logError(errorInfo);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    this.showUserError(errorInfo);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    // await this.sendErrorAnalytics(errorInfo);
  }

  /**
   * –ü–∞—Ä—Å–∏–Ω–≥ –æ—à–∏–±–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∏–¥
   */
  parseError(error, context) {
    let errorInfo = {
      id: Date.now() + Math.random(),
      timestamp: new Date().toISOString(),
      context,
      userAgent: navigator.userAgent,
      url: window.location.href
    };

    if (error instanceof APIError) {
      errorInfo = {
        ...errorInfo,
        type: 'API_ERROR',
        status: error.status,
        message: error.message,
        details: error.details,
        userMessage: error.getUserMessage()
      };
    } else if (error instanceof Error) {
      errorInfo = {
        ...errorInfo,
        type: 'JAVASCRIPT_ERROR',
        name: error.name,
        message: error.message,
        stack: error.stack,
        userMessage: this.getGenericUserMessage(error)
      };
    } else if (typeof error === 'string') {
      errorInfo = {
        ...errorInfo,
        type: 'STRING_ERROR',
        message: error,
        userMessage: error
      };
    } else {
      errorInfo = {
        ...errorInfo,
        type: 'UNKNOWN_ERROR',
        message: 'Unknown error occurred',
        details: error,
        userMessage: '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'
      };
    }

    return errorInfo;
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
   */
  getGenericUserMessage(error) {
    if (error.name === 'TypeError') {
      return '–û—à–∏–±–∫–∞ –≤ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
    }
    
    if (error.name === 'NetworkError' || error.message.includes('fetch')) {
      return '–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
    }
    
    return '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
  }

  /**
   * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
   */
  logError(errorInfo) {
    console.group(`üö® Error [${errorInfo.type}]`);
    console.error('Message:', errorInfo.message);
    console.error('Context:', errorInfo.context);
    console.error('Details:', errorInfo);
    console.groupEnd();
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   */
  showUserError(errorInfo) {
    // Haptic feedback –¥–ª—è –æ—à–∏–±–æ–∫
    haptic('ERROR');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ UI
    if (errorInfo.type === 'API_ERROR' && errorInfo.status >= 500) {
      // –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ - –±–æ–ª–µ–µ –º—è–≥–∫–æ
      this.showToast(errorInfo.userMessage, 'error', 5000);
    } else {
      // –û–±—ã—á–Ω—ã–µ –æ—à–∏–±–∫–∏
      this.showToast(errorInfo.userMessage, 'error', 3000);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    appState.showError(errorInfo.userMessage);
  }

  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   */
  showToast(message, type = 'info', duration = 3000) {
    // –°–æ–∑–¥–∞–µ–º toast —ç–ª–µ–º–µ–Ω—Ç
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
    document.body.appendChild(toast);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => toast.classList.add('toast-show'), 100);
    
    // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
    setTimeout(() => {
      toast.classList.remove('toast-show');
      setTimeout(() => document.body.removeChild(toast), 300);
    }, duration);
  }

  /**
   * Retry —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
   */
  async withRetry(asyncFn, maxRetries = 3, delay = 1000) {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await asyncFn();
      } catch (error) {
        if (attempt === maxRetries) {
          throw error;
        }
        
        // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, attempt - 1)));
      }
    }
  }

  /**
   * –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   */
  async safeAsync(asyncFn, fallback = null, context = 'SAFE_ASYNC') {
    try {
      return await asyncFn();
    } catch (error) {
      await this.handleError(error, context);
      return fallback;
    }
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   */
  getRecentErrors(limit = 10) {
    return this.errorQueue.slice(-limit);
  }

  /**
   * –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –æ—à–∏–±–æ–∫
   */
  clearErrors() {
    this.errorQueue = [];
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
const errorHandler = new ErrorHandler();

// –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
window.handleError = (error, context) => errorHandler.handleError(error, context);
window.safeAsync = (fn, fallback, context) => errorHandler.safeAsync(fn, fallback, context);
window.withRetry = (fn, retries, delay) => errorHandler.withRetry(fn, retries, delay);
```

## CSS –¥–ª—è toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```css
/* Toast —Å—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--surface);
  color: var(--text-primary);
  padding: 12px 16px;
  border-radius: 8px;
  box-shadow: 0 4px 12px var(--shadow-color);
  transform: translateX(calc(100% + 20px));
  transition: transform 0.3s ease;
  z-index: 10000;
  max-width: 300px;
  font-size: 14px;
  border-left: 4px solid var(--primary-color);
}

.toast-show {
  transform: translateX(0);
}

.toast-error {
  border-left-color: var(--error);
  background: #fee;
}

.toast-success {
  border-left-color: var(--success);
  background: #efe;
}

.toast-warning {
  border-left-color: var(--warning);
  background: #fef3cd;
}
```

---

# üöÄ IMPLEMENTATION-GUIDE.md

## –ü–æ—à–∞–≥–æ–≤—ã–π –≥–∞–π–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–î–µ–Ω—å 1)

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Version 3
mkdir -p client/reader-app-v2/{css/{components,pages},js/{core,services,components/{ui,navigation,modals,quote},pages,utils},assets/{icons,images,fonts},config,docs}

# 2. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
touch client/reader-app-v2/index.html
touch client/reader-app-v2/manifest.json
touch client/reader-app-v2/service-worker.js

# 3. CSS —Ñ–∞–π–ª—ã
touch client/reader-app-v2/css/{variables,reset,base,mobile}.css
touch client/reader-app-v2/css/components/{buttons,cards,forms,modals,navigation}.css
touch client/reader-app-v2/css/pages/{home,diary,reports,catalog,community}.css

# 4. JavaScript —Ñ–∞–π–ª—ã
touch client/reader-app-v2/js/core/{App,Router,State}.js
touch client/reader-app-v2/js/services/{api,telegram,storage,ios-fix}.js
```

### –≠—Ç–∞–ø 2: CSS Foundation (–î–µ–Ω—å 2)

```javascript
// –ù–∞—á–∏–Ω–∞–µ–º —Å variables.css - –∫–æ–ø–∏—Ä—É–µ–º –∏–∑ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤
/* client/reader-app-v2/css/variables.css */
:root {
  --primary-color: #D2452C;
  --primary-dark: #B53A23;
  --primary-light: #E85A42;
  --text-primary: #2D2D2D;
  --text-secondary: #666666;
  --background: #F5F2EC;
  --surface: #FFFFFF;
  --border: #E6E0D6;
  --border-radius: 12px;
  --transition-normal: 0.3s ease;
}

body.dark-theme {
  --primary-color: #E85A42;
  --text-primary: #F0F0F0;
  --background: #1A1A1A;
  --surface: #2A2A2A;
  --border: #404040;
}
```

### –≠—Ç–∞–ø 3: Core JavaScript (–î–µ–Ω—å 3-4)

```javascript
// js/core/App.js - –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class App {
  constructor() {
    this.router = null;
    this.state = appState;
    this.telegram = telegram;
    this.currentPage = null;
    
    this.init();
  }

  async init() {
    try {
      // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
      if (this.telegram.isAvailable) {
        this.telegram.init();
      }

      // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞
      this.router = new Router();
      
      // 3. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      await this.loadUser();
      
      // 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UI
      this.setupUI();
      
      // 5. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
      this.router.init();
      
      console.log('üöÄ App initialized successfully');
      
    } catch (error) {
      console.error('Failed to initialize app:', error);
      handleError(error, 'APP_INIT');
    }
  }

  async loadUser() {
    if (this.telegram.user) {
      // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
      const userData = await QuotesAPI.authenticateTelegram(this.telegram.getInitData());
      this.state.setUser(userData);
    }
  }

  setupUI() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
    this.setupTheme();
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    this.setupNavigation();
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    this.setupModals();
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', () => {
  window.App = new App();
});
```

### –≠—Ç–∞–ø 4: –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–î–µ–Ω—å 5-10)

```javascript
// js/pages/HomePage.js - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
class HomePage {
  constructor() {
    this.container = document.getElementById('home-page');
    this.data = {
      stats: null,
      topBooks: [],
      recentQuotes: []
    };
  }

  async render() {
    try {
      appState.showLoading('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...');
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
      const [stats, topBooks, recentQuotes] = await Promise.all([
        QuotesAPI.getQuoteStats(),
        ReportsAPI.getTopBooks(),
        QuotesAPI.getUserQuotes({ limit: 3 })
      ]);
      
      this.data = { stats, topBooks, recentQuotes };
      
      // –†–µ–Ω–¥–µ—Ä–∏–º UI
      this.renderStats();
      this.renderTopBooks();
      this.renderRecentQuotes();
      
      appState.hideLoading();
      
    } catch (error) {
      handleError(error, 'HOME_PAGE_RENDER');
    }
  }

  renderStats() {
    const statsContainer = this.container.querySelector('.stats-grid');
    statsContainer.innerHTML = `
      <div class="stat-card">
        <div class="stat-number">${this.data.stats.totalQuotes}</div>
        <div class="stat-label">–¶–∏—Ç–∞—Ç —Å–æ–±—Ä–∞–Ω–æ</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${this.data.stats.currentStreak}</div>
        <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
      </div>
    `;
  }

  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞...
}
```

### –≠—Ç–∞–ø 5: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI (–î–µ–Ω—å 11-15)

```javascript
// js/components/ui/Modal.js - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
class Modal {
  constructor(name, options = {}) {
    this.name = name;
    this.options = {
      closeOnOverlay: true,
      closeOnEscape: true,
      showCloseButton: true,
      ...options
    };
    
    this.isOpen = false;
    this.element = null;
    this.onCloseCallback = null;
    
    this.create();
  }

  create() {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    this.element = document.createElement('div');
    this.element.className = 'modal-overlay';
    this.element.innerHTML = `
      <div class="modal-content ${this.name}-modal">
        <div class="modal-header">
          <h3 class="modal-title"></h3>
          ${this.options.showCloseButton ? '<button class="modal-close">√ó</button>' : ''}
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer"></div>
      </div>
    `;
    
    this.setupEventListeners();
  }

  open(data = null) {
    if (this.isOpen) return;
    
    this.isOpen = true;
    this.data = data;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
    document.body.appendChild(this.element);
    
    // Haptic feedback
    haptic('MODAL_OPENED');
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    requestAnimationFrame(() => {
      this.element.classList.add('modal-show');
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    appState.openModal(this.name, data);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥ –≤ Telegram
    if (telegram.isAvailable) {
      telegram.showBackButton();
    }
  }

  close() {
    if (!this.isOpen) return;
    
    this.isOpen = false;
    
    // Haptic feedback
    haptic('MODAL_CLOSED');
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.element.classList.remove('modal-show');
    
    setTimeout(() => {
      if (this.element.parentNode) {
        document.body.removeChild(this.element);
      }
    }, 300);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    appState.closeModal(this.name);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
    if (telegram.isAvailable) {
      telegram.hideBackButton();
    }
    
    // Callback
    if (this.onCloseCallback) {
      this.onCloseCallback();
    }
  }
}
```

### –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–î–µ–Ω—å 16-21)

```javascript
// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
async function testApp() {
  console.log('üß™ Running app tests...');
  
  try {
    // –¢–µ—Å—Ç API
    await QuotesAPI.getQuoteStats();
    console.log('‚úÖ API connection works');
    
    // –¢–µ—Å—Ç Telegram
    if (telegram.isAvailable) {
      telegram.hapticFeedback('impact', 'light');
      console.log('‚úÖ Telegram SDK works');
    }
    
    // –¢–µ—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
    appState.setState({ test: true }, 'TEST');
    console.log('‚úÖ State management works');
    
    // –¢–µ—Å—Ç —Ä–æ—É—Ç–µ—Ä–∞
    App.router.navigate('diary');
    console.log('‚úÖ Router works');
    
    console.log('‚úÖ All tests passed');
    
  } catch (error) {
    console.error('‚ùå Tests failed:', error);
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ dev —Ä–µ–∂–∏–º–µ
if (process.env.NODE_ENV === 'development') {
  window.testApp = testApp;
}
```

---

# üîó CONCEPTS-TO-CODE.md

## –ü–µ—Ä–µ–Ω–æ—Å –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥

### –ò–∑ HTML –∫–æ–Ω—Ü–µ–ø—Ç–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```html
<!-- –ö–û–ù–¶–ï–ü–¢ (—Å—Ç–∞—Ç–∏—á–Ω—ã–π HTML) -->
<div class="quote-item">
  <div class="quote-text">"–í –∫–∞–∂–¥–æ–º —Å–ª–æ–≤–µ ‚Äî —Ü–µ–ª–∞—è –∂–∏–∑–Ω—å"</div>
  <div class="quote-meta">
    <span>–ú–∞—Ä–∏–Ω–∞ –¶–≤–µ—Ç–∞–µ–≤–∞</span>
    <div class="quote-actions">
      <button class="quote-action">‚ù§Ô∏è</button>
      <button class="quote-action">‚úèÔ∏è</button>
    </div>
  </div>
</div>
```

```javascript
// –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
class QuoteCard {
  constructor(quote) {
    this.quote = quote;
    this.element = null;
    this.render();
  }

  render() {
    this.element = document.createElement('div');
    this.element.className = 'quote-item';
    this.element.innerHTML = `
      <div class="quote-text">"${this.escapeHtml(this.quote.text)}"</div>
      <div class="quote-meta">
        <span>${this.escapeHtml(this.quote.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä')}</span>
        <div class="quote-actions">
          <button class="quote-action like-btn ${this.quote.isLiked ? 'liked' : ''}" 
                  onclick="this.toggleLike()">‚ù§Ô∏è</button>
          <button class="quote-action edit-btn" 
                  onclick="this.editQuote()">‚úèÔ∏è</button>
          <button class="quote-action delete-btn" 
                  onclick="this.deleteQuote()">üóëÔ∏è</button>
        </div>
      </div>
    `;
    
    this.setupEventListeners();
  }

  async toggleLike() {
    try {
      haptic('QUOTE_LIKED');
      const result = await QuotesAPI.toggleLike(this.quote._id);
      this.quote.isLiked = result.isLiked;
      this.updateLikeButton();
    } catch (error) {
      handleError(error, 'TOGGLE_LIKE');
    }
  }

  editQuote() {
    haptic('BUTTON_PRESS');
    const editModal = new EditQuoteModal();
    editModal.open(this.quote);
  }

  async deleteQuote() {
    const confirmed = await new Promise(resolve => {
      telegram.showConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ü–∏—Ç–∞—Ç—É?', resolve);
    });
    
    if (confirmed) {
      try {
        await QuotesAPI.deleteQuote(this.quote._id);
        appState.deleteQuote(this.quote._id);
        this.element.remove();
        haptic('SUCCESS');
      } catch (error) {
        handleError(error, 'DELETE_QUOTE');
      }
    }
  }
}
```

### –ò–∑ CSS –∫–æ–Ω—Ü–µ–ø—Ç–∞ –≤ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏

```css
/* –ö–û–ù–¶–ï–ü–¢ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) */
.quote-item {
  background: #FFFFFF;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
  border-left: 4px solid #D2452C;
}

/* –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ + —Å–æ—Å—Ç–æ—è–Ω–∏—è) */
.quote-item {
  background: var(--surface);
  border-radius: var(--border-radius-small);
  padding: 12px;
  margin-bottom: 12px;
  border-left: 4px solid var(--primary-color);
  transition: var(--transition-normal);
  cursor: pointer;
}

.quote-item:hover {
  background: var(--background-light);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px var(--shadow-color);
}

.quote-item.liked .like-btn {
  color: var(--primary-color);
  transform: scale(1.1);
}

.quote-item.editing {
  border-left-color: var(--warning);
  background: var(--surface-warm);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 480px) {
  .quote-item {
    padding: 8px;
    margin-bottom: 8px;
  }
  
  .quote-actions {
    flex-direction: column;
    gap: 4px;
  }
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API

```javascript
// –ö–û–ù–¶–ï–ü–¢ (–¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
const demoQuotes = [
  { text: "–í –∫–∞–∂–¥–æ–º —Å–ª–æ–≤–µ ‚Äî —Ü–µ–ª–∞—è –∂–∏–∑–Ω—å", author: "–ú–∞—Ä–∏–Ω–∞ –¶–≤–µ—Ç–∞–µ–≤–∞" },
  { text: "–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ª—é–±–∏—Ç—å", author: "–≠—Ä–∏—Ö –§—Ä–æ–º–º" }
];

// –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
class DiaryPage {
  async loadQuotes() {
    try {
      appState.showLoading('–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ —Ü–∏—Ç–∞—Ç—ã...');
      
      const response = await QuotesAPI.getUserQuotes({
        page: this.currentPage,
        limit: 20,
        category: this.selectedCategory,
        search: this.searchQuery
      });
      
      if (response.success) {
        const quotes = response.data.quotes.map(quote => new QuoteCard(quote));
        this.renderQuotes(quotes);
        appState.setQuotes(response.data.quotes);
      }
      
      appState.hideLoading();
      
    } catch (error) {
      handleError(error, 'LOAD_QUOTES');
    }
  }
}
```

## –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞

### –®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```javascript
// js/pages/TemplatePage.js
class TemplatePage {
  constructor() {
    this.container = document.getElementById('template-page');
    this.data = {};
    this.isLoaded = false;
  }

  async render() {
    if (!this.container) return;
    
    try {
      appState.showLoading('–ó–∞–≥—Ä—É–∑–∫–∞...');
      
      // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      await this.loadData();
      
      // 2. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI
      this.renderUI();
      
      // 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
      this.setupEventListeners();
      
      this.isLoaded = true;
      appState.hideLoading();
      
    } catch (error) {
      handleError(error, 'TEMPLATE_PAGE_RENDER');
    }
  }

  async loadData() {
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö
    this.data = await api.get('/some-endpoint');
  }

  renderUI() {
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö
    this.container.innerHTML = `<!-- UI template -->`;
  }

  setupEventListeners() {
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö
  }

  show() {
    if (this.container) {
      this.container.style.display = 'block';
      if (!this.isLoaded) {
        this.render();
      }
    }
  }

  hide() {
    if (this.container) {
      this.container.style.display = 'none';
    }
  }
}
```

### –®–∞–±–ª–æ–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞

```javascript
// js/components/modals/TemplateModal.js  
class TemplateModal extends Modal {
  constructor(options = {}) {
    super('template', {
      showCloseButton: true,
      closeOnOverlay: true,
      ...options
    });
  }

  open(data) {
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
    this.element.querySelector('.modal-title').textContent = '–ó–∞–≥–æ–ª–æ–≤–æ–∫';
    this.element.querySelector('.modal-body').innerHTML = this.renderBody(data);
    this.element.querySelector('.modal-footer').innerHTML = this.renderFooter();
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    this.setupModalEventListeners();
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º
    super.open(data);
  }

  renderBody(data) {
    return `<!-- Modal body template -->`;
  }

  renderFooter() {
    return `
      <button class="btn btn-secondary" onclick="this.close()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" onclick="this.save()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    `;
  }

  setupModalEventListeners() {
    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏
  }

  async save() {
    try {
      // –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      haptic('SUCCESS');
      this.close();
    } catch (error) {
      handleError(error, 'MODAL_SAVE');
    }
  }
}
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ç–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É –Ω–∞—Å –±—É–¥–µ—Ç:

1. **üìã –ü–ª–∞–Ω Version 3** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
2. **üì± –ö–æ–Ω—Ü–µ–ø—Ç—ã UI** - –∫—Ä–∞—Å–∏–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞  
3. **üìö –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –≥–∞–π–¥—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
4. **üîó –®–∞–±–ª–æ–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å–∞** - –∫–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∫–æ–Ω—Ü–µ–ø—Ç—ã –≤ –∫–æ–¥

**= 100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ —Ä–∞–∑–¥—É–º–∏–π!**